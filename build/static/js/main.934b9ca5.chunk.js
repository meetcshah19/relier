(this["webpackJsonprelier-front"]=this["webpackJsonprelier-front"]||[]).push([[0],{163:function(e,t,i){},245:function(e,t,i){},246:function(e,t,i){},270:function(e,t,i){},294:function(e,t,i){},295:function(e,t,i){},403:function(e,t,i){"use strict";i.r(t);var a=i(0),n=i.n(a),s=i(12),o=i.n(s),r=(i(245),i(21)),c=(i(246),i(456)),l=i(467),d=i(479),h=i(455),u=i(478),m=i(457),g=i(477),p=i(94),b=i.n(p),j=i(64),v=i(445),f=i(447),O=i(2),x=Object(v.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}}));function S(e){var t=e.email,i=e.changeEmail,a=e.password,n=e.changePassword,s=e.onLogin,o=e.setFlip,r=e.emailWarn,l=e.passwordWarn,p=x();return Object(O.jsxs)(f.a,{component:"main",maxWidth:"xs",children:[Object(O.jsxs)("div",{className:p.paper,children:[Object(O.jsx)(d.a,{className:p.avatar,children:Object(O.jsx)(b.a,{})}),Object(O.jsx)(j.a,{component:"h1",variant:"h5",children:"Sign in"}),Object(O.jsxs)("form",{className:p.form,children:[Object(O.jsx)(u.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:t,onChange:function(e){return i(e.target.value)},error:r,helperText:r?"Please enter a valid email address":""}),Object(O.jsx)(u.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:a,onChange:function(e){return n(e.target.value)},error:l,helperText:l?"Please enter a password containing at least 1 special character and 8 characters":""}),Object(O.jsx)(h.a,{onClick:s,fullWidth:!0,variant:"contained",color:"primary",className:p.submit,children:"Sign In"}),Object(O.jsx)(c.a,{container:!0,children:Object(O.jsx)(c.a,{item:!0,children:Object(O.jsx)(m.a,{href:"#",variant:"body2",onClick:function(){return o(!0)},children:"Don't have an account? Sign Up"})})})]})]}),Object(O.jsx)(g.a,{mt:8})]})}var y=Object(v.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}}));function k(e){var t=e.email,i=e.changeEmail,a=e.password,n=e.changePassword,s=e.name,o=e.setName,r=e.onRegister,l=e.setFlip,p=e.emailWarn,v=e.passwordWarn,x=y();return Object(O.jsxs)(f.a,{component:"main",maxWidth:"xs",children:[Object(O.jsxs)("div",{className:x.paper,children:[Object(O.jsx)(d.a,{className:x.avatar,children:Object(O.jsx)(b.a,{})}),Object(O.jsx)(j.a,{component:"h1",variant:"h5",children:"Sign up"}),Object(O.jsxs)("form",{className:x.form,children:[Object(O.jsx)(u.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"name",label:"Name",name:"name",autoComplete:"Name",autoFocus:!0,value:s,onChange:function(e){return o(e.target.value)}}),Object(O.jsx)(u.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:t,onChange:function(e){return i(e.target.value)},error:p,helperText:p?"Please enter a valid email address":""}),Object(O.jsx)(u.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:a,onChange:function(e){return n(e.target.value)},error:v,helperText:v?"Please enter a password containing at least 1 special character and 8 characters":""}),Object(O.jsx)(h.a,{onClick:r,fullWidth:!0,variant:"contained",color:"primary",className:x.submit,children:"Sign Up"}),Object(O.jsx)(c.a,{container:!0,children:Object(O.jsx)(c.a,{item:!0,children:Object(O.jsx)(m.a,{href:"#",variant:"body2",onClick:function(){return l(!1)},children:"Already have an account? Sign In"})})})]})]}),Object(O.jsx)(g.a,{mt:8})]})}var C=i(465),N=i(466),w=i(14),R=i(198),A=i.n(R),I=i(459),T=i(31),E=i.n(T),M=i(34),F=i.n(M),B=i(46),L=i(469),U=i(468),D=i(464),P=i(458),W=i(199),V=i.n(W),J=i(460),z=i(463),_=i(462),q=i(461),H=Object(v.a)((function(e){return{icon:{marginRight:e.spacing(2)},heroContent:{backgroundColor:e.palette.background.paper,padding:e.spacing(1,0,5)},heroButtons:{marginTop:e.spacing(4)},cardGrid:{paddingTop:e.spacing(8),paddingBottom:e.spacing(8)},card:{height:"100%",display:"flex",flexDirection:"column"},cardMedia:{paddingTop:"56.25%"},cardContent:{flexGrow:1},orange:{color:e.palette.getContrastText(P.a[500]),backgroundColor:P.a[500]},extendedIcon:{marginRight:e.spacing(1)},fab:{position:"fixed",bottom:e.spacing(8),right:e.spacing(8)}}}));function K(){var e=Object(a.useState)(!1),t=Object(r.a)(e,2),i=t[0],n=t[1],s=Object(a.useState)(!1),o=Object(r.a)(s,2),m=o[0],g=o[1],p=Object(a.useState)(""),b=Object(r.a)(p,2),v=b[0],x=b[1],S=Object(a.useState)(""),y=Object(r.a)(S,2),k=y[0],R=y[1],A=Object(a.useState)([]),T=Object(r.a)(A,2),M=T[0],P=T[1],W=H(),K=Object(w.e)();Object(a.useEffect)((function(){F.a.get("token")||K.push("/")}),[K]),Object(a.useEffect)((function(){G()}),[]);function G(){console.log("bla");var e={method:"get",url:"/api/secure/teams/",headers:{Authorization:"Bearer ".concat(F.a.get("token"))}};E()(e).then((function(e){console.log(JSON.stringify(e.data)),P(e.data)})).catch((function(e){console.log(e)}))}var Y=function(){n(!1)},X=function(){g(!1)};return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(B.b,{to:"/vc/".concat(Math.random().toString(36).substring(7)),style:{textDecoration:"none"},target:"_blank",children:Object(O.jsxs)(I.a,{variant:"extended",className:W.fab,color:"primary",children:[Object(O.jsx)(V.a,{className:W.extendedIcon}),"Start Instant Call"]})}),Object(O.jsx)("div",{children:Object(O.jsxs)(J.a,{open:i,onClose:Y,"aria-labelledby":"form-dialog-title",maxWidth:"xs",fullWidth:!0,children:[Object(O.jsx)(q.a,{id:"form-dialog-title",children:"Create New Team"}),Object(O.jsx)(_.a,{children:Object(O.jsx)(u.a,{autoFocus:!0,margin:"dense",id:"name",label:"Team Name",fullWidth:!0,value:v,onChange:function(e){return x(e.target.value)}})}),Object(O.jsxs)(z.a,{children:[Object(O.jsx)(h.a,{onClick:Y,color:"primary",children:"Cancel"}),Object(O.jsx)(h.a,{onClick:function(){var e=JSON.stringify({name:v}),t={method:"put",url:"/api/secure/teams/",headers:{Authorization:"Bearer ".concat(F.a.get("token")),"Content-Type":"application/json"},data:e};E()(t).then((function(e){console.log(JSON.stringify(e.data)),n(!1),G()})).catch((function(e){console.log(e)}))},color:"primary",children:"Create Team"})]})]})}),Object(O.jsx)("div",{children:Object(O.jsxs)(J.a,{open:m,onClose:X,"aria-labelledby":"form-dialog-title",maxWidth:"xs",fullWidth:!0,children:[Object(O.jsx)(q.a,{id:"form-dialog-title",children:"Join existing team"}),Object(O.jsx)(_.a,{children:Object(O.jsx)(u.a,{autoFocus:!0,margin:"dense",id:"name",label:"Team Code",fullWidth:!0,value:k,onChange:function(e){return R(e.target.value)}})}),Object(O.jsxs)(z.a,{children:[Object(O.jsx)(h.a,{onClick:X,color:"primary",children:"Cancel"}),Object(O.jsx)(h.a,{onClick:function(){var e={method:"post",url:"/api/secure/teams/".concat(k),headers:{Authorization:"Bearer ".concat(F.a.get("token"))}};E()(e).then((function(e){console.log(JSON.stringify(e.data)),g(!1),G()})).catch((function(e){console.log(e)}))},color:"primary",children:"Join Team"})]})]})}),Object(O.jsx)(D.a,{}),Object(O.jsx)(C.a,{style:{alignItems:"center"},position:"relative",children:Object(O.jsx)(N.a,{children:Object(O.jsx)(j.a,{variant:"h4",color:"inherit",noWrap:!0,children:"Relier"})})}),Object(O.jsx)("main",{children:Object(O.jsx)(f.a,{className:W.cardGrid,maxWidth:"md",children:Object(O.jsxs)(c.a,{container:!0,spacing:4,children:[Object(O.jsx)(c.a,{item:!0,xs:12,sm:6,md:4,children:Object(O.jsxs)(l.a,{className:W.card,style:{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center"},children:[Object(O.jsx)(U.a,{style:{alignItems:"center",display:"flex",justifyContent:"center",paddingBottom:0},children:Object(O.jsx)(h.a,{variant:"contained",color:"primary",onClick:function(){n(!0)},children:"Create Team"})}),Object(O.jsx)(U.a,{style:{alignItems:"center",display:"flex",justifyContent:"center"},children:Object(O.jsx)(h.a,{variant:"outlined",color:"primary",onClick:function(){g(!0)},children:"Join Team"})})]})}),M.map((function(e){return Object(O.jsx)(c.a,{item:!0,xs:12,sm:6,md:4,children:Object(O.jsxs)(l.a,{className:W.card,hoverable:!0,children:[Object(O.jsx)("div",{style:{cursor:"pointer"},children:Object(O.jsxs)(B.b,{to:"/team/".concat(e.secret),style:{textDecoration:"none"},target:"_blank",children:[Object(O.jsx)(U.a,{style:{alignItems:"center",display:"flex",paddingBottom:0,justifyContent:"center"},children:Object(O.jsx)(d.a,{className:W.orange,variant:"square",children:e.name.substring(0,1)})}),Object(O.jsx)(U.a,{className:W.cardContent,style:{paddingBottom:0},children:Object(O.jsx)(j.a,{gutterBottom:!0,variant:"h5",component:"h2",children:e.name})})]})}),Object(O.jsx)(L.a,{children:Object(O.jsx)(h.a,{size:"small",color:"primary",onClick:function(){},children:"Leave"})})]})},e.id)}))]})})})]})}var G=i(23),Y=i(24),X=i(10),Q=i(37),Z=i(36),$=(i(270),i(200)),ee=(i(163),function(e){Object(Q.a)(i,e);var t=Object(Z.a)(i);function i(e){var a;return Object(G.a)(this,i),(a=t.call(this,e)).videoRef=n.a.createRef(),a}return Object(Y.a)(i,[{key:"componentDidMount",value:function(){var e=this;this.props&&this.props.user.streamManager&&this.videoRef&&(console.log("PROPS: ",this.props),this.props.user.getStreamManager().addVideoElement(this.videoRef.current)),this.props&&this.props.user.streamManager.session&&this.props.user&&this.videoRef&&this.props.user.streamManager.session.on("signal:userChanged",(function(t){void 0!==JSON.parse(t.data).isScreenShareActive&&e.props.user.getStreamManager().addVideoElement(e.videoRef.current)}))}},{key:"componentDidUpdate",value:function(e){e&&this.videoRef&&this.props.user.getStreamManager().addVideoElement(this.videoRef.current)}},{key:"render",value:function(){return Object(O.jsx)("video",{autoPlay:!0,id:"video-"+this.props.user.getStreamManager().stream.streamId,ref:this.videoRef,muted:this.props.mutedSound})}}]),i}(a.Component)),te=i(100),ie=i.n(te),ae=i(99),ne=i.n(ae),se=i(202),oe=i.n(se),re=i(201),ce=i.n(re),le=i(450),de=i(449),he=i(480),ue=i(470),me=i(98),ge=i.n(me),pe=i(454),be=function(e){Object(Q.a)(i,e);var t=Object(Z.a)(i);function i(e){var a;return Object(G.a)(this,i),(a=t.call(this,e)).state={nickname:a.props.user.getNickname(),showForm:!1,mutedSound:!1,isFormValid:!0},a.handleChange=a.handleChange.bind(Object(X.a)(a)),a.handlePressKey=a.handlePressKey.bind(Object(X.a)(a)),a.toggleNicknameForm=a.toggleNicknameForm.bind(Object(X.a)(a)),a.toggleSound=a.toggleSound.bind(Object(X.a)(a)),a}return Object(Y.a)(i,[{key:"handleChange",value:function(e){this.setState({nickname:e.target.value}),e.preventDefault()}},{key:"toggleNicknameForm",value:function(){this.props.user.isLocal()&&this.setState({showForm:!this.state.showForm})}},{key:"toggleSound",value:function(){this.setState({mutedSound:!this.state.mutedSound})}},{key:"handlePressKey",value:function(e){"Enter"===e.key&&(console.log(this.state.nickname),this.state.nickname.length>=3&&this.state.nickname.length<=20?(this.props.handleNickname(this.state.nickname),this.toggleNicknameForm(),this.setState({isFormValid:!0})):this.setState({isFormValid:!1}))}},{key:"render",value:function(){return Object(O.jsxs)("div",{className:"OT_widget-container",children:[Object(O.jsx)("div",{className:"pointer nickname",children:this.state.showForm?Object(O.jsxs)(le.a,{id:"nicknameForm",children:[Object(O.jsx)(ue.a,{color:"inherit",id:"closeButton",onClick:this.toggleNicknameForm,children:Object(O.jsx)(ge.a,{})}),Object(O.jsx)(he.a,{htmlFor:"name-simple",id:"label",style:{padding:"10px"},children:"Nickname"}),Object(O.jsx)(de.a,{color:"inherit",id:"input",value:this.state.nickname,onChange:this.handleChange,onKeyPress:this.handlePressKey,required:!0}),!this.state.isFormValid&&this.state.nickname.length<=0&&Object(O.jsx)(pe.a,{id:"name-error-text",children:"Nickname is too short!"}),!this.state.isFormValid&&this.state.nickname.length>=20&&Object(O.jsx)(pe.a,{id:"name-error-text",children:"Nickname is too long!"})]}):Object(O.jsxs)("div",{style:{padding:"10px"},onClick:this.toggleNicknameForm,children:[Object(O.jsx)("span",{id:"nickname",children:this.props.user.getNickname()}),this.props.user.isLocal()&&Object(O.jsx)("span",{id:"",children:" (edit)"})]})}),void 0!==this.props.user&&void 0!==this.props.user.getStreamManager()?Object(O.jsxs)("div",{className:"streamComponent",children:[Object(O.jsx)(ee,{user:this.props.user,mutedSound:this.state.mutedSound}),Object(O.jsxs)("div",{id:"statusIcons",children:[this.props.user.isVideoActive()?null:Object(O.jsx)("div",{id:"camIcon",children:Object(O.jsx)(ne.a,{id:"statusCam"})}),this.props.user.isAudioActive()?null:Object(O.jsx)("div",{id:"micIcon",children:Object(O.jsx)(ie.a,{id:"statusMic"})})]}),Object(O.jsx)("div",{children:!this.props.user.isLocal()&&Object(O.jsx)(ue.a,{id:"volumeButton",onClick:this.toggleSound,children:this.state.mutedSound?Object(O.jsx)(ce.a,{color:"secondary"}):Object(O.jsx)(oe.a,{})})})]}):null]})}}]),i}(a.Component),je=(i(294),function(e){Object(Q.a)(i,e);var t=Object(Z.a)(i);function i(e){var a;return Object(G.a)(this,i),(a=t.call(this,e)).openviduExtensionUrl="https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",a.state={isInstalled:!1},a.goToChromePage=a.goToChromePage.bind(Object(X.a)(a)),a.onNoClick=a.onNoClick.bind(Object(X.a)(a)),a.refreshBrowser=a.refreshBrowser.bind(Object(X.a)(a)),a}return Object(Y.a)(i,[{key:"componentWillReceiveProps",value:function(e){}},{key:"componentDidMount",value:function(){}},{key:"onNoClick",value:function(){this.props.cancelClicked()}},{key:"goToChromePage",value:function(){window.open(this.openviduExtensionUrl),this.setState({isInstalled:!0})}},{key:"refreshBrowser",value:function(){window.location.reload()}},{key:"render",value:function(){return Object(O.jsx)("div",{children:this.props&&this.props.showDialog?Object(O.jsx)("div",{id:"dialogExtension",children:Object(O.jsxs)(l.a,{id:"card",children:[Object(O.jsxs)(U.a,{children:[Object(O.jsx)(j.a,{color:"textSecondary",children:"Hello"}),Object(O.jsx)(j.a,{color:"textSecondary",children:"You need install this chrome extension and refresh the browser for can share your screen."})]}),Object(O.jsxs)(L.a,{children:[Object(O.jsx)(h.a,{size:"small",onClick:this.onNoClick,children:"Cancel"}),Object(O.jsx)(h.a,{size:"small",onClick:this.goToChromePage,children:"Install"}),this.state.isInstalled?Object(O.jsx)(h.a,{size:"small",onClick:this.refreshBrowser,children:"Refresh"}):null]})]})}):null})}}]),i}(a.Component)),ve=i(101),fe=i.n(ve),Oe=(i(295),i(481)),xe=function(e){Object(Q.a)(i,e);var t=Object(Z.a)(i);function i(e){var a;return Object(G.a)(this,i),(a=t.call(this,e)).state={messageList:[],message:""},a.chatScroll=n.a.createRef(),a.handleChange=a.handleChange.bind(Object(X.a)(a)),a.handlePressKey=a.handlePressKey.bind(Object(X.a)(a)),a.close=a.close.bind(Object(X.a)(a)),a.sendMessage=a.sendMessage.bind(Object(X.a)(a)),a}return Object(Y.a)(i,[{key:"componentDidMount",value:function(){var e=this;this.props.user.getStreamManager().stream.session.on("signal:chat",(function(t){var i=JSON.parse(t.data),a=e.state.messageList;a.push({connectionId:t.from.connectionId,nickname:i.nickname,message:i.message});var n=window.document;setTimeout((function(){var t=n.getElementById("userImg-"+(e.state.messageList.length-1)),a=n.getElementById("video-"+i.streamId);t.getContext("2d").drawImage(a,200,120,285,285,0,0,60,60),e.props.messageReceived()}),50),e.setState({messageList:a}),e.scrollToBottom()}))}},{key:"handleChange",value:function(e){this.setState({message:e.target.value})}},{key:"handlePressKey",value:function(e){"Enter"===e.key&&this.sendMessage()}},{key:"sendMessage",value:function(){if(console.log(this.state.message),this.props.user&&this.state.message){var e=this.state.message.replace(/ +(?= )/g,"");if(""!==e&&" "!==e){var t={message:e,nickname:this.props.user.getNickname(),streamId:this.props.user.getStreamManager().stream.streamId};this.props.user.getStreamManager().stream.session.signal({data:JSON.stringify(t),type:"chat"})}}this.setState({message:""})}},{key:"scrollToBottom",value:function(){var e=this;setTimeout((function(){try{e.chatScroll.current.scrollTop=e.chatScroll.current.scrollHeight}catch(t){}}),20)}},{key:"close",value:function(){this.props.close(void 0)}},{key:"render",value:function(){var e=this,t={display:this.props.chatDisplay};return Object(O.jsx)("div",{id:"chatContainer",children:Object(O.jsxs)("div",{id:"chatComponent",style:t,children:[Object(O.jsxs)("div",{id:"chatToolbar",children:[Object(O.jsxs)("span",{children:[this.props.user.getStreamManager().stream.session.sessionId," - CHAT"]}),Object(O.jsx)(ue.a,{id:"closeButton",onClick:this.close,children:Object(O.jsx)(ge.a,{color:"secondary"})})]}),Object(O.jsx)("div",{className:"message-wrap",ref:this.chatScroll,children:this.state.messageList.map((function(t,i){return Object(O.jsxs)("div",{id:"remoteUsers",className:"message"+(t.connectionId!==e.props.user.getConnectionId()?" left":" right"),children:[Object(O.jsx)("canvas",{id:"userImg-"+i,width:"60",height:"60",className:"user-img"}),Object(O.jsxs)("div",{className:"msg-detail",children:[Object(O.jsx)("div",{className:"msg-info",children:Object(O.jsxs)("p",{children:[" ",t.nickname]})}),Object(O.jsxs)("div",{className:"msg-content",children:[Object(O.jsx)("span",{className:"triangle"}),Object(O.jsx)("p",{className:"text",children:t.message})]})]})]},i)}))}),Object(O.jsxs)("div",{id:"messageInput",children:[Object(O.jsx)("input",{placeholder:"Send a messge",id:"chatInput",value:this.state.message,onChange:this.handleChange,onKeyPress:this.handlePressKey}),Object(O.jsx)(Oe.a,{title:"Send message",children:Object(O.jsx)(I.a,{size:"small",id:"sendButton",onClick:this.sendMessage,children:Object(O.jsx)(fe.a,{})})})]})]})})}}]),i}(a.Component),Se=i(54),ye=i.n(Se),ke=function(){function e(){Object(G.a)(this,e)}return Object(Y.a)(e,[{key:"fixAspectRatio",value:function(e,t){var i=e.querySelector(".OT_root");if(i){var a=i.style.width;i.style.width=t+"px",i.style.width=a||""}}},{key:"positionElement",value:function(e,t,i,a,n,s){var o=this,r={left:t+"px",top:i+"px",width:a+"px",height:n+"px"};this.fixAspectRatio(e,a),s&&ye.a?(ye()(e).stop(),ye()(e).animate(r,s.duration||200,s.easing||"swing",(function(){o.fixAspectRatio(e,a),s.complete&&s.complete.call(o)}))):ye()(e).css(r),this.fixAspectRatio(e,a)}},{key:"getVideoRatio",value:function(e){if(!e)return 3/4;var t=e.querySelector("video");return t&&t.videoHeight&&t.videoWidth?t.videoHeight/t.videoWidth:e.videoHeight&&e.videoWidth?e.videoHeight/e.videoWidth:3/4}},{key:"getCSSNumber",value:function(e,t){var i=ye()(e).css(t);return i?parseInt(i,10):0}},{key:"cheapUUID",value:function(){return(1e8*Math.random()).toFixed(0)}},{key:"getHeight",value:function(e){var t=ye()(e).css("height");return t?parseInt(t,10):0}},{key:"getWidth",value:function(e){var t=ye()(e).css("width");return t?parseInt(t,10):0}},{key:"getBestDimensions",value:function(e,t,i,a,n,s){for(var o,r,c,l,d,h,u,m=1;m<=i;m++){var g=m,p=Math.ceil(i/g);(u=(h=Math.floor(n/p))/(d=Math.floor(a/g)))>t?h=d*(u=t):u<e&&(d=h/(u=e));var b=d*h*i;(void 0===o||b>o)&&(o=b,s=h,l=d,r=g,c=p)}return{maxArea:o,targetCols:r,targetRows:c,targetHeight:s,targetWidth:l,ratio:s/l}}},{key:"arrange",value:function(e,t,i,a,n,s,o,r,c){var l,d,h=e.length;if(s){var u=this.getVideoRatio(e.length>0?e[0]:null);d=this.getBestDimensions(u,u,h,t,i,l)}else d=this.getBestDimensions(o,r,h,t,i,l);for(var m,g=0,p=0,b=[],j=0;j<e.length;j++){j%d.targetCols===0&&(m={children:[],width:0,height:0},b.push(m));var v=e[j];m.children.push(v);var f=d.targetWidth;l=d.targetHeight,s&&(f=l/this.getVideoRatio(v)),m.width+=f,m.height=l}for(var O=0,x=0,S=0;S<b.length;S++)(m=b[S]).width>t?(m.height=Math.floor(m.height*(t/m.width)),m.width=t):m.width<t&&(x+=1),O+=m.height;if(O<i&&x>0){var y=i-O;O=0;for(var k=0;k<b.length;k++){if((m=b[k]).width<t){var C=y/x;C/m.height>(t-m.width)/m.width&&(C=Math.floor((t-m.width)/m.width*m.height)),m.width+=Math.floor(C/m.height*m.width),m.height+=C,y-=C,x-=1}O+=m.height}}p=(i-O)/2;for(var N=0;N<b.length;N++){g=(t-(m=b[N]).width)/2;for(var w=0;w<m.children.length;w++){var R=m.children[w],A=d.targetWidth;l=m.height,s&&(A=Math.floor(l/this.getVideoRatio(R))),R.style.position="absolute";var I=A-this.getCSSNumber(R,"paddingLeft")-this.getCSSNumber(R,"paddingRight")-this.getCSSNumber(R,"marginLeft")-this.getCSSNumber(R,"marginRight")-this.getCSSNumber(R,"borderLeft")-this.getCSSNumber(R,"borderRight"),T=l-this.getCSSNumber(R,"paddingTop")-this.getCSSNumber(R,"paddingBottom")-this.getCSSNumber(R,"marginTop")-this.getCSSNumber(R,"marginBottom")-this.getCSSNumber(R,"borderTop")-this.getCSSNumber(R,"borderBottom");this.positionElement(R,g+a,p+n,I,T,c),g+=A}p+=l}}},{key:"filterDisplayNone",value:function(e){return"none"!==e.style.display}},{key:"updateLayout",value:function(){if("none"!==this.layoutContainer.style.display){var e=this.layoutContainer.id;e||(e="OT_"+this.cheapUUID(),this.layoutContainer.id=e);var t,i,a=this.getHeight(this.layoutContainer)-this.getCSSNumber(this.layoutContainer,"borderTop")-this.getCSSNumber(this.layoutContainer,"borderBottom"),n=this.getWidth(this.layoutContainer)-this.getCSSNumber(this.layoutContainer,"borderLeft")-this.getCSSNumber(this.layoutContainer,"borderRight"),s=a/n,o=0,r=0,c=0,l=0,d=Array.prototype.filter.call(this.layoutContainer.querySelectorAll("#"+e+">."+this.opts.bigClass),this.filterDisplayNone),h=Array.prototype.filter.call(this.layoutContainer.querySelectorAll("#"+e+">*:not(."+this.opts.bigClass+")"),this.filterDisplayNone);if(d.length>0&&h.length>0)s>this.getVideoRatio(d[0])?(t=n,c=a-(r=i=Math.floor(a*this.opts.bigPercentage))):(i=a,l=n-(o=t=Math.floor(n*this.opts.bigPercentage))),this.opts.bigFirst?(this.arrange(d,t,i,0,0,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate),this.arrange(h,n-o,a-r,o,r,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate)):(this.arrange(h,n-o,a-r,0,0,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate),this.arrange(d,t,i,l,c,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate));else d.length>0&&0===h.length?this.arrange(d,n,a,0,0,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate):this.arrange(h,n-o,a-r,o,r,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate)}}},{key:"initLayoutContainer",value:function(e,t){this.opts={maxRatio:null!=t.maxRatio?t.maxRatio:1.5,minRatio:null!=t.minRatio?t.minRatio:9/16,fixedRatio:null!=t.fixedRatio&&t.fixedRatio,animate:null!=t.animate&&t.animate,bigClass:null!=t.bigClass?t.bigClass:"OT_big",bigPercentage:null!=t.bigPercentage?t.bigPercentage:.8,bigFixedRatio:null!=t.bigFixedRatio&&t.bigFixedRatio,bigMaxRatio:null!=t.bigMaxRatio?t.bigMaxRatio:1.5,bigMinRatio:null!=t.bigMinRatio?t.bigMinRatio:9/16,bigFirst:null==t.bigFirst||t.bigFirst},this.layoutContainer="string"===typeof e?ye()(e):e}},{key:"setLayoutOptions",value:function(e){this.opts=e}}]),e}(),Ce=function(){function e(){Object(G.a)(this,e),this.connectionId="",this.audioActive=!0,this.videoActive=!0,this.screenShareActive=!1,this.nickname="",this.streamManager=null,this.type="local"}return Object(Y.a)(e,[{key:"isAudioActive",value:function(){return this.audioActive}},{key:"isVideoActive",value:function(){return this.videoActive}},{key:"isScreenShareActive",value:function(){return this.screenShareActive}},{key:"getConnectionId",value:function(){return this.connectionId}},{key:"getNickname",value:function(){return this.nickname}},{key:"getStreamManager",value:function(){return this.streamManager}},{key:"isLocal",value:function(){return"local"===this.type}},{key:"isRemote",value:function(){return!this.isLocal()}},{key:"setAudioActive",value:function(e){this.audioActive=e}},{key:"setVideoActive",value:function(e){this.videoActive=e}},{key:"setScreenShareActive",value:function(e){this.screenShareActive=e}},{key:"setStreamManager",value:function(e){this.streamManager=e}},{key:"setConnectionId",value:function(e){this.connectionId=e}},{key:"setNickname",value:function(e){this.nickname=e}},{key:"setType",value:function(e){"local"===e|"remote"===e&&(this.type=e)}}]),e}(),Ne=i(204),we=i.n(Ne),Re=i(205),Ae=i.n(Re),Ie=i(206),Te=i.n(Ie),Ee=i(207),Me=i.n(Ee),Fe=i(208),Be=i.n(Fe),Le=i(209),Ue=i.n(Le),De=i(210),Pe=i.n(De),We=function(e){Object(Q.a)(i,e);var t=Object(Z.a)(i);function i(e){var a;return Object(G.a)(this,i),(a=t.call(this,e)).state={fullscreen:!1},a.camStatusChanged=a.camStatusChanged.bind(Object(X.a)(a)),a.micStatusChanged=a.micStatusChanged.bind(Object(X.a)(a)),a.screenShare=a.screenShare.bind(Object(X.a)(a)),a.stopScreenShare=a.stopScreenShare.bind(Object(X.a)(a)),a.toggleFullscreen=a.toggleFullscreen.bind(Object(X.a)(a)),a.leaveSession=a.leaveSession.bind(Object(X.a)(a)),a.toggleChat=a.toggleChat.bind(Object(X.a)(a)),a}return Object(Y.a)(i,[{key:"micStatusChanged",value:function(){this.props.micStatusChanged()}},{key:"camStatusChanged",value:function(){this.props.camStatusChanged()}},{key:"screenShare",value:function(){this.props.screenShare()}},{key:"stopScreenShare",value:function(){this.props.stopScreenShare()}},{key:"toggleFullscreen",value:function(){this.setState({fullscreen:!this.state.fullscreen}),this.props.toggleFullscreen()}},{key:"leaveSession",value:function(){this.props.leaveSession()}},{key:"toggleChat",value:function(){this.props.toggleChat()}},{key:"render",value:function(){this.props.sessionId;var e=this.props.user;return Object(O.jsx)(C.a,{className:"toolbar",id:"header",children:Object(O.jsxs)(N.a,{className:"toolbar",children:[Object(O.jsx)("div",{id:"navSessionInfo",children:this.props.sessionId&&Object(O.jsx)("div",{id:"titleContent",children:Object(O.jsx)(h.a,{children:"Invite"})})}),Object(O.jsxs)("div",{className:"buttonsContent",children:[Object(O.jsx)(ue.a,{color:"inherit",className:"navButton",id:"navMicButton",onClick:this.micStatusChanged,children:void 0!==e&&e.isAudioActive()?Object(O.jsx)(we.a,{}):Object(O.jsx)(ie.a,{color:"secondary"})}),Object(O.jsx)(ue.a,{color:"inherit",className:"navButton",id:"navCamButton",onClick:this.camStatusChanged,children:void 0!==e&&e.isVideoActive()?Object(O.jsx)(Ae.a,{}):Object(O.jsx)(ne.a,{color:"secondary"})}),Object(O.jsx)(ue.a,{color:"inherit",className:"navButton",onClick:this.screenShare,children:void 0!==e&&e.isScreenShareActive()?Object(O.jsx)(Te.a,{}):Object(O.jsx)(Me.a,{})}),void 0!==e&&e.isScreenShareActive()&&Object(O.jsx)(ue.a,{onClick:this.stopScreenShare,id:"navScreenButton",children:Object(O.jsx)(Be.a,{color:"secondary"})}),Object(O.jsx)(ue.a,{color:"secondary",className:"navButton",onClick:this.leaveSession,id:"navLeaveButton",children:Object(O.jsx)(Ue.a,{})}),Object(O.jsxs)(ue.a,{color:"inherit",onClick:this.toggleChat,id:"navChatButton",style:{top:"0"},children:[this.props.showNotification&&Object(O.jsx)("div",{id:"point",className:""}),Object(O.jsx)(Oe.a,{title:"Chat",children:Object(O.jsx)(Pe.a,{})})]})]})]})})}}]),i}(a.Component),Ve=new Ce,Je=function(e){Object(Q.a)(i,e);var t=Object(Z.a)(i);function i(e){var a;Object(G.a)(this,i),(a=t.call(this,e)).OPENVIDU_SERVER_URL=a.props.openviduServerUrl?a.props.openviduServerUrl:"https://"+window.location.hostname+":4443",a.OPENVIDU_SERVER_SECRET=a.props.openviduSecret?a.props.openviduSecret:"MY_SECRET",a.hasBeenUpdated=!1,a.layout=new ke;var n=a.props.sessionName?a.props.sessionName:"new",s=a.props.user?a.props.user:"OpenVidu_User"+Math.floor(100*Math.random());return a.remotes=[],a.localUserAccessAllowed=!1,a.state={mySessionId:n,myUserName:s,session:n,localUser:void 0,subscribers:[],chatDisplay:"none"},a.joinSession=a.joinSession.bind(Object(X.a)(a)),a.leaveSession=a.leaveSession.bind(Object(X.a)(a)),a.onbeforeunload=a.onbeforeunload.bind(Object(X.a)(a)),a.updateLayout=a.updateLayout.bind(Object(X.a)(a)),a.camStatusChanged=a.camStatusChanged.bind(Object(X.a)(a)),a.micStatusChanged=a.micStatusChanged.bind(Object(X.a)(a)),a.nicknameChanged=a.nicknameChanged.bind(Object(X.a)(a)),a.toggleFullscreen=a.toggleFullscreen.bind(Object(X.a)(a)),a.screenShare=a.screenShare.bind(Object(X.a)(a)),a.stopScreenShare=a.stopScreenShare.bind(Object(X.a)(a)),a.closeDialogExtension=a.closeDialogExtension.bind(Object(X.a)(a)),a.toggleChat=a.toggleChat.bind(Object(X.a)(a)),a.checkNotification=a.checkNotification.bind(Object(X.a)(a)),a.checkSize=a.checkSize.bind(Object(X.a)(a)),a}return Object(Y.a)(i,[{key:"componentDidMount",value:function(){this.layout.initLayoutContainer(document.getElementById("layout"),{maxRatio:1.5,minRatio:9/16,fixedRatio:!1,bigClass:"OV_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16,bigFirst:!0,animate:!0}),window.addEventListener("beforeunload",this.onbeforeunload),window.addEventListener("resize",this.updateLayout),window.addEventListener("resize",this.checkSize),this.joinSession()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.onbeforeunload),window.removeEventListener("resize",this.updateLayout),window.removeEventListener("resize",this.checkSize),this.leaveSession()}},{key:"onbeforeunload",value:function(e){this.leaveSession()}},{key:"joinSession",value:function(){var e=this;this.OV=new $.OpenVidu,this.setState({session:this.OV.initSession()},(function(){e.subscribeToStreamCreated(),e.connectToSession()}))}},{key:"connectToSession",value:function(){var e=this;void 0!==this.props.token?(console.log("token received: ",this.props.token),this.connect(this.props.token)):this.getToken().then((function(t){console.log(t),e.connect(t)})).catch((function(t){e.props.error&&e.props.error({error:t.error,messgae:t.message,code:t.code,status:t.status}),console.log("There was an error getting the token:",t.code,t.message),alert("There was an error getting the token:",t.message)}))}},{key:"connect",value:function(e){var t=this;this.state.session.connect(e,{clientData:this.state.myUserName}).then((function(){t.connectWebCam()})).catch((function(e){t.props.error&&t.props.error({error:e.error,messgae:e.message,code:e.code,status:e.status}),alert("There was an error connecting to the session:",e.message),console.log("There was an error connecting to the session:",e.code,e.message)}))}},{key:"connectWebCam",value:function(){var e=this,t=this.OV.initPublisher(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:Ve.isAudioActive(),publishVideo:Ve.isVideoActive(),resolution:"640x480",frameRate:30,insertMode:"APPEND"});this.state.session.capabilities.publish&&t.on("accessAllowed",(function(){e.state.session.publish(t).then((function(){e.updateSubscribers(),e.localUserAccessAllowed=!0,e.props.joinSession&&e.props.joinSession()}))})),Ve.setNickname(this.state.myUserName),Ve.setConnectionId(this.state.session.connection.connectionId),Ve.setScreenShareActive(!1),Ve.setStreamManager(t),this.subscribeToUserChanged(),this.subscribeToStreamDestroyed(),this.sendSignalUserChanged({isScreenShareActive:Ve.isScreenShareActive()}),this.setState({localUser:Ve},(function(){e.state.localUser.getStreamManager().on("streamPlaying",(function(i){e.updateLayout(),t.videos[0].video.parentElement.classList.remove("custom-class")}))}))}},{key:"updateSubscribers",value:function(){var e=this,t=this.remotes;this.setState({subscribers:t},(function(){e.state.localUser&&e.sendSignalUserChanged({isAudioActive:e.state.localUser.isAudioActive(),isVideoActive:e.state.localUser.isVideoActive(),nickname:e.state.localUser.getNickname(),isScreenShareActive:e.state.localUser.isScreenShareActive()}),e.updateLayout()}))}},{key:"leaveSession",value:function(){var e=this.state.session;e&&e.disconnect(),this.OV=null,this.setState({session:void 0,subscribers:[],mySessionId:"SessionA",myUserName:"OpenVidu_User"+Math.floor(100*Math.random()),localUser:void 0}),this.props.leaveSession&&this.props.leaveSession()}},{key:"camStatusChanged",value:function(){Ve.setVideoActive(!Ve.isVideoActive()),Ve.getStreamManager().publishVideo(Ve.isVideoActive()),this.sendSignalUserChanged({isVideoActive:Ve.isVideoActive()}),this.setState({localUser:Ve})}},{key:"micStatusChanged",value:function(){Ve.setAudioActive(!Ve.isAudioActive()),Ve.getStreamManager().publishAudio(Ve.isAudioActive()),this.sendSignalUserChanged({isAudioActive:Ve.isAudioActive()}),this.setState({localUser:Ve})}},{key:"nicknameChanged",value:function(e){var t=this.state.localUser;t.setNickname(e),this.setState({localUser:t}),this.sendSignalUserChanged({nickname:this.state.localUser.getNickname()})}},{key:"deleteSubscriber",value:function(e){var t=this.state.subscribers,i=t.filter((function(t){return t.getStreamManager().stream===e}))[0],a=t.indexOf(i,0);a>-1&&(t.splice(a,1),this.setState({subscribers:t}))}},{key:"subscribeToStreamCreated",value:function(){var e=this;this.state.session.on("streamCreated",(function(t){var i=e.state.session.subscribe(t.stream,void 0);i.on("streamPlaying",(function(t){e.checkSomeoneShareScreen(),i.videos[0].video.parentElement.classList.remove("custom-class")}));var a=new Ce;a.setStreamManager(i),a.setConnectionId(t.stream.connection.connectionId),a.setType("remote");var n=t.stream.connection.data.split("%")[0];a.setNickname(JSON.parse(n).clientData),e.remotes.push(a),e.localUserAccessAllowed&&e.updateSubscribers()}))}},{key:"subscribeToStreamDestroyed",value:function(){var e=this;this.state.session.on("streamDestroyed",(function(t){e.deleteSubscriber(t.stream),setTimeout((function(){e.checkSomeoneShareScreen()}),20),t.preventDefault(),e.updateLayout()}))}},{key:"subscribeToUserChanged",value:function(){var e=this;this.state.session.on("signal:userChanged",(function(t){var i=e.state.subscribers;i.forEach((function(e){if(e.getConnectionId()===t.from.connectionId){var i=JSON.parse(t.data);console.log("EVENTO REMOTE: ",t.data),void 0!==i.isAudioActive&&e.setAudioActive(i.isAudioActive),void 0!==i.isVideoActive&&e.setVideoActive(i.isVideoActive),void 0!==i.nickname&&e.setNickname(i.nickname),void 0!==i.isScreenShareActive&&e.setScreenShareActive(i.isScreenShareActive)}})),e.setState({subscribers:i},(function(){return e.checkSomeoneShareScreen()}))}))}},{key:"updateLayout",value:function(){var e=this;setTimeout((function(){e.layout.updateLayout()}),20)}},{key:"sendSignalUserChanged",value:function(e){var t={data:JSON.stringify(e),type:"userChanged"};this.state.session.signal(t)}},{key:"toggleFullscreen",value:function(){var e=window.document,t=e.getElementById("container");e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}},{key:"screenShare",value:function(){var e=this,t=-1!==navigator.userAgent.indexOf("Firefox")?"window":"screen",i=this.OV.initPublisher(void 0,{videoSource:t,publishAudio:Ve.isAudioActive(),publishVideo:Ve.isVideoActive(),mirror:!1},(function(t){t&&"SCREEN_EXTENSION_NOT_INSTALLED"===t.name?e.setState({showExtensionDialog:!0}):t&&"SCREEN_SHARING_NOT_SUPPORTED"===t.name?alert("Your browser does not support screen sharing"):t&&"SCREEN_EXTENSION_DISABLED"===t.name?alert("You need to enable screen sharing extension"):t&&"SCREEN_CAPTURE_DENIED"===t.name&&alert("You need to choose a window or application to share")}));i.once("accessAllowed",(function(){e.state.session.unpublish(Ve.getStreamManager()),Ve.setStreamManager(i),e.state.session.publish(Ve.getStreamManager()).then((function(){Ve.setScreenShareActive(!0),e.setState({localUser:Ve},(function(){e.sendSignalUserChanged({isScreenShareActive:Ve.isScreenShareActive()})}))}))})),i.on("streamPlaying",(function(){e.updateLayout(),i.videos[0].video.parentElement.classList.remove("custom-class")}))}},{key:"closeDialogExtension",value:function(){this.setState({showExtensionDialog:!1})}},{key:"stopScreenShare",value:function(){this.state.session.unpublish(Ve.getStreamManager()),this.connectWebCam()}},{key:"checkSomeoneShareScreen",value:function(){var e={maxRatio:1.5,minRatio:9/16,fixedRatio:this.state.subscribers.some((function(e){return e.isScreenShareActive()}))||Ve.isScreenShareActive(),bigClass:"OV_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16,bigFirst:!0,animate:!0};this.layout.setLayoutOptions(e),this.updateLayout()}},{key:"toggleChat",value:function(e){var t=e;void 0===t&&(t="none"===this.state.chatDisplay?"block":"none"),"block"===t?this.setState({chatDisplay:t,messageReceived:!1}):(console.log("chat",t),this.setState({chatDisplay:t})),this.updateLayout()}},{key:"checkNotification",value:function(e){this.setState({messageReceived:"none"===this.state.chatDisplay})}},{key:"checkSize",value:function(){document.getElementById("layout").offsetWidth<=700&&!this.hasBeenUpdated&&(this.toggleChat("none"),this.hasBeenUpdated=!0),document.getElementById("layout").offsetWidth>700&&this.hasBeenUpdated&&(this.hasBeenUpdated=!1)}},{key:"render",value:function(){var e=this.state.mySessionId,t=this.state.localUser,i={display:this.state.chatDisplay};return Object(O.jsxs)("div",{className:"container",id:"container",children:[Object(O.jsx)(We,{sessionId:e,user:t,showNotification:this.state.messageReceived,camStatusChanged:this.camStatusChanged,micStatusChanged:this.micStatusChanged,screenShare:this.screenShare,stopScreenShare:this.stopScreenShare,toggleFullscreen:this.toggleFullscreen,leaveSession:this.leaveSession,toggleChat:this.toggleChat}),Object(O.jsx)(je,{showDialog:this.state.showExtensionDialog,cancelClicked:this.closeDialogExtension}),Object(O.jsxs)("div",{id:"layout",className:"bounds",children:[void 0!==t&&void 0!==t.getStreamManager()&&Object(O.jsx)("div",{className:"OT_root OT_publisher custom-class",id:"localUser",children:Object(O.jsx)(be,{user:t,handleNickname:this.nicknameChanged})}),this.state.subscribers.map((function(e,t){return Object(O.jsx)("div",{className:"OT_root OT_publisher custom-class",id:"remoteUsers",children:Object(O.jsx)(be,{user:e,streamId:e.streamManager.stream.streamId})},t)})),void 0!==t&&void 0!==t.getStreamManager()&&Object(O.jsx)("div",{className:"OT_root OT_publisher custom-class",style:i,children:Object(O.jsx)(xe,{user:t,chatDisplay:this.state.chatDisplay,close:this.toggleChat,messageReceived:this.checkNotification})})]})]})}},{key:"getToken",value:function(){var e=this;return this.createSession(this.state.mySessionId).then((function(t){return e.createToken(t)}))}},{key:"createSession",value:function(e){return new Promise((function(t,i){var a={method:"post",url:"/api/video/create",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTQsIm5hbWUiOiJNZWV0IFNoYWgiLCJpYXQiOjE2MjQ2NTE1MDd9.7prfxCA4FKaFL2L_LcTG9qEuy6h6CiJVSDyqGRS6H8s","Content-Type":"application/json"},data:JSON.stringify({customSessionId:e})};E()(a).then((function(e){console.log("CREATE SESION",e),t(e.data.session_id)})).catch((function(e){console.log(e)}))}))}},{key:"createToken",value:function(e){return new Promise((function(t,i){JSON.stringify({});var a={method:"post",url:"/api/vc/"+e,headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTMsIm5hbWUiOiJNZWV0IFNoYWgiLCJpYXQiOjE2MjQ1NzkwMzR9.nWWp1uzyrWGn4Sfl2ro_r3UxDiH6gxHexRLW2vzyamc"}};E()(a).then((function(e){console.log(JSON.stringify(e.data)),console.log("TOKEN",e),t(e.data.token)})).catch((function(e){console.log(e)}))}))}}]),i}(a.Component);function ze(){var e=Object(w.g)().sid;return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(Je,{sessionName:e}),Object(O.jsx)("h1",{children:e})]})}var _e=i(63),qe=i.n(_e),He=i(102),Ke=i(211),Ge=i(4),Ye=i(482),Xe=i(453),Qe=i(475),Ze=i(214),$e=i.n(Ze),et=i(213),tt=i.n(et),it=i(472),at=i(473),nt=i(474),st=i(471),ot=i(103),rt=i.n(ot),ct=i(215),lt=i.n(ct),dt=i(135),ht=i(476),ut=i(216),mt=i.n(ut),gt=i(212),pt=(st.a,it.a,at.a,rt.a,nt.a,it.a,at.a,rt.a,nt.a,it.a,at.a,rt.a,nt.a,Object(v.a)((function(e){return{root:{display:"flex"},orange:{color:e.palette.getContrastText(P.a[500]),backgroundColor:P.a[500]},toolbar:{paddingRight:24},toolbarIcon:Object(Ke.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 8px"},e.mixins.toolbar),appBar:{zIndex:e.zIndex.drawer+1,transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{marginLeft:240,width:"calc(100% - ".concat(240,"px)"),transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},menuButton:{marginRight:36},menuButtonHidden:{display:"none"},title:{flexGrow:1},drawerPaper:{position:"relative",height:"100vh",whiteSpace:"nowrap",width:240,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen}),overflowX:"hidden"},drawerPaperClose:Object(He.a)({overflowX:"hidden",position:"relative",height:"100vh",transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),width:e.spacing(7)},e.breakpoints.up("sm"),{width:e.spacing(9)}),appBarSpacer:e.mixins.toolbar,content:{flexGrow:1,height:"100vh",overflow:"auto"},container:{paddingTop:e.spacing(4),paddingBottom:e.spacing(4),maxWidth:900},paper:{padding:e.spacing(2),display:"flex",overflow:"auto",flexDirection:"column"},fixedHeight:{height:240},bottomToolbar:{position:"absolute",paddingTop:"0",bottom:"0",left:"0",width:240,background:"#fafafa"}}})));function bt(){var e=Object(gt.io)().connect(),t=Object(w.g)().secret,i=Object(a.useRef)(""),s=Object(a.useState)([]),o=Object(r.a)(s,2),l=o[0],h=o[1],m=Object(a.useState)([]),g=Object(r.a)(m,2),p=g[0],b=g[1],v=pt(),x=n.a.useState(!0),S=Object(r.a)(x,2),y=S[0],k=S[1],R=Object(a.useState)(),A=Object(r.a)(R,2),I=A[0],T=A[1];Object(a.useEffect)((function(){console.log(e),e.on("message",(function(e){console.log(e)})),function(){var i={method:"get",url:"/api/secure/channels/".concat(t),headers:{Authorization:"Bearer ".concat(F.a.get("token"))}};E()(i).then((function(t){console.log(JSON.stringify(t.data)),b(t.data),function(t){I&&e.emit("unsubscribe",I.secret);T(t),e.emit("subscribe",t.secret),function(e){var t={method:"get",url:"/api/secure/messages/".concat(e.secret),headers:{Authorization:"Bearer ".concat(F.a.get("token"))}};E()(t).then((function(e){console.log(JSON.stringify(e.data)),h(e.data)})).catch((function(e){console.log(e)}))}(t)}(t.data[0])})).catch((function(e){console.log(e)}))}()}),[]);Object(Ge.a)(v.paper,v.fixedHeight);return Object(O.jsxs)("div",{className:v.root,children:[Object(O.jsx)(D.a,{}),Object(O.jsx)(C.a,{position:"absolute",className:Object(Ge.a)(v.appBar,y&&v.appBarShift),children:Object(O.jsxs)(N.a,{className:v.toolbar,children:[Object(O.jsx)(ue.a,{edge:"start",color:"inherit","aria-label":"open drawer",onClick:function(){k(!0)},className:Object(Ge.a)(v.menuButton,y&&v.menuButtonHidden),children:Object(O.jsx)(tt.a,{})}),Object(O.jsx)(j.a,{component:"h1",variant:"h4",color:"inherit",noWrap:!0,className:v.title,children:"Relier"})]})}),Object(O.jsxs)(Ye.a,{variant:"permanent",classes:{paper:Object(Ge.a)(v.drawerPaper,!y&&v.drawerPaperClose)},open:y,children:[Object(O.jsx)(Xe.a,{children:Object(O.jsxs)(it.a,{button:!0,children:[Object(O.jsx)(at.a,{onClick:function(){k(!1)},children:Object(O.jsx)($e.a,{})}),Object(O.jsx)(nt.a,{primary:"Team name"})]})}),Object(O.jsx)(Qe.a,{}),Object(O.jsx)(Xe.a,{style:{height:"calc(100vh-179px}",overflowY:"auto",overflowX:"hidden"},children:Object(O.jsx)("div",{children:p.map((function(e){return Object(O.jsxs)(it.a,{button:!0,children:[Object(O.jsx)(at.a,{children:Object(O.jsx)(d.a,{variant:"rounded",className:v.orange,children:e.name.substring(0,1)})}),Object(O.jsx)(nt.a,{primary:e.name})]})}))})}),Object(O.jsxs)(Xe.a,{className:v.bottomToolbar,children:[Object(O.jsx)(Qe.a,{}),Object(O.jsxs)(it.a,{button:!0,style:{paddingTop:10},children:[Object(O.jsx)(at.a,{style:{paddingLeft:6},children:Object(O.jsx)(lt.a,{color:"secondary"})}),Object(O.jsx)(nt.a,{primary:"Add channels"})]}),Object(O.jsxs)(it.a,{button:!0,children:[Object(O.jsx)(at.a,{style:{paddingLeft:6},children:Object(O.jsx)(mt.a,{color:"secondary"})}),Object(O.jsx)(nt.a,{primary:"Browse channels"})]})]})]}),Object(O.jsxs)("main",{className:v.content,children:[Object(O.jsx)("div",{className:v.appBarSpacer}),Object(O.jsx)(f.a,{maxWidth:"lg",className:v.container,style:{paddingBottom:0},children:Object(O.jsxs)(c.a,{container:!0,spacing:3,style:{paddingBottom:0},children:[Object(O.jsx)(c.a,{item:!0,xs:12,children:l.map((function(e){return Object(O.jsx)(dt.a,{id:e.id,elevation:1,style:{padding:12,marginBottom:24},children:Object(O.jsxs)(c.a,{container:!0,spacing:3,style:{overflow:!0},children:[Object(O.jsx)(c.a,{item:!0,xs:1,style:{paddingBottom:0},children:Object(O.jsx)(d.a,{variant:"rounded",className:v.orange,style:{height:32,width:32,margin:"auto",paddingBottom:0},children:e.sender.name.substring(0,1)})}),Object(O.jsx)(c.a,{item:!0,xs:5,style:{paddingLeft:0,paddingBottom:0},children:Object(O.jsx)(j.a,{align:"left",color:"primary",children:e.sender.name})}),Object(O.jsx)(c.a,{item:!0,xs:6,style:{paddingBottom:0},children:Object(O.jsx)(j.a,{align:"right",color:"textSecondary",children:e.timestamp})}),Object(O.jsx)(c.a,{item:!0,xs:11,style:{marginLeft:"auto",paddingLeft:0,paddingTop:0},children:Object(O.jsx)(j.a,{align:"left",children:e.text})})]})})}))}),Object(O.jsx)(c.a,{item:!0,xs:12,style:{position:"sticky",bottom:0,paddingBottom:24,paddingTop:24,backgroundColor:"#fafafa",width:900},children:Object(O.jsx)(u.a,{id:"outlined-textarea",label:"Message",placeholder:"Message",inputRef:i,type:"text",multiline:!0,variant:"outlined",fullWidth:!0,InputProps:{endAdornment:Object(O.jsx)(ht.a,{position:"end",children:Object(O.jsx)(ue.a,{"aria-label":"send",edge:"end",onClick:function(){!function(){console.log(i.current.value),console.log(e),e.emit("send",{room:I.secret,message:i.current.value});var t=JSON.stringify({text:i.current.value}),a={method:"put",url:"/api/secure/messages/".concat(I.secret),headers:{Authorization:"Bearer ".concat(F.a.get("token")),"Content-Type":"application/json"},data:t};E()(a).then((function(e){console.log(JSON.stringify(e.data))})).catch((function(e){console.log(e)}))}()},children:Object(O.jsx)(fe.a,{})})})}})})]})})]})]})}var jt=function(){var e=Object(w.e)(),t=Object(w.f)(),i=Object(a.useState)(""),n=Object(r.a)(i,2),s=n[0],o=n[1],d=Object(a.useState)(""),h=Object(r.a)(d,2),u=h[0],m=h[1],g=Object(a.useState)(!1),p=Object(r.a)(g,2),b=p[0],v=p[1],f=Object(a.useState)(!1),x=Object(r.a)(f,2),y=x[0],R=x[1],I=Object(a.useState)(""),T=Object(r.a)(I,2),M=T[0],B=T[1],L=Object(a.useState)(!1),U=Object(r.a)(L,2),D=U[0],P=U[1];Object(a.useEffect)((function(){console.log(t.pathname),F.a.get("token")&&"/"===t.pathname&&e.push("/home")}),[e]);var W=function(e){o(e),qe.a.isEmail(e)?v(!1):v(!0)},V=function(e){m(e),qe.a.isStrongPassword(e,{minLength:8,minLowercase:0,minUppercase:0,minNumbers:0,minSymbols:1})?R(!1):R(!0)},J=function(){if(qe.a.isEmail(s)&&qe.a.isStrongPassword(u,{minLength:8,minLowercase:0,minUppercase:0,minNumbers:0,minSymbols:1})){var t={method:"post",url:"/api/login",headers:{"Content-Type":"application/json"},data:JSON.stringify({email:s,password:u})};E()(t).then((function(t){console.log(JSON.stringify(t.data)),F.a.set("token",t.data.token,{expires:365,secure:!0}),e.push("/home")})).catch((function(e){console.log(e)}))}},z=function(){if(qe.a.isEmail(s)&&qe.a.isStrongPassword(u,{minLength:8,minLowercase:0,minUppercase:0,minNumbers:0,minSymbols:1})){var t={method:"post",url:"/api/users",headers:{"Content-Type":"application/json"},data:JSON.stringify({email:s,password:u,name:M})};E()(t).then((function(t){console.log(JSON.stringify(t.data)),F.a.set("token",t.data.token,{expires:365,secure:!0}),e.push("/home")})).catch((function(e){console.log(e)}))}};return Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)(w.a,{path:"/",exact:!0,render:function(e){return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)("div",{className:"login",children:Object(O.jsxs)(c.a,{container:!0,direction:"column",justify:"center",alignItems:"center",style:{minHeight:"100vh",background:"#fafafa"},children:[Object(O.jsx)(c.a,{container:!0,item:!0,xs:3,children:Object(O.jsx)(C.a,{style:{alignItems:"center"},children:Object(O.jsx)(N.a,{children:Object(O.jsx)(j.a,{variant:"h4",children:"Relier"})})})}),Object(O.jsx)(c.a,{container:!0,item:!0,xs:3,children:Object(O.jsxs)(A.a,{isFlipped:D,flipDirection:"vertical",children:[Object(O.jsx)(l.a,{elevation:3,children:Object(O.jsx)(S,{email:s,changeEmail:W,password:u,changePassword:V,onLogin:J,setFlip:P,emailWarn:b,passwordWarn:y})}),Object(O.jsx)(l.a,{elevation:3,children:Object(O.jsx)(k,{email:s,changeEmail:W,password:u,changePassword:V,name:M,setName:B,setFlip:P,onRegister:z,emailWarn:b,passwordWarn:y})})]})})]})})})}}),Object(O.jsx)(w.a,{path:"/home",component:K}),Object(O.jsx)(w.a,{path:"/vc/:sid",children:Object(O.jsx)(ze,{})}),Object(O.jsx)(w.a,{path:"/team/:secret",children:Object(O.jsx)(bt,{})})]})},vt=function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,484)).then((function(t){var i=t.getCLS,a=t.getFID,n=t.getFCP,s=t.getLCP,o=t.getTTFB;i(e),a(e),n(e),s(e),o(e)}))};o.a.render(Object(O.jsx)(n.a.StrictMode,{children:Object(O.jsx)(B.a,{children:Object(O.jsx)(jt,{})})}),document.getElementById("root")),vt()}},[[403,1,2]]]);
//# sourceMappingURL=main.934b9ca5.chunk.js.map