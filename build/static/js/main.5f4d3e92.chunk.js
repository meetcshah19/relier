(this["webpackJsonprelier-front"]=this["webpackJsonprelier-front"]||[]).push([[0],{167:function(e,t,n){},248:function(e,t,n){},249:function(e,t,n){},273:function(e,t,n){},297:function(e,t,n){},298:function(e,t,n){},406:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),s=n(12),o=n.n(s),r=(n(248),n(16)),c=(n(249),n(455)),l=n(466),d=n(477),h=n(454),u=n(476),m=n(456),g=n(475),j=n(96),b=n.n(j),p=n(64),v=n(444),f=n(446),O=n(1),x=Object(v.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}}));function S(e){var t=e.email,n=e.changeEmail,i=e.password,a=e.changePassword,s=e.onLogin,o=e.setFlip,r=e.emailWarn,l=e.passwordWarn,j=x();return Object(O.jsxs)(f.a,{component:"main",maxWidth:"xs",children:[Object(O.jsxs)("div",{className:j.paper,children:[Object(O.jsx)(d.a,{className:j.avatar,children:Object(O.jsx)(b.a,{})}),Object(O.jsx)(p.a,{component:"h1",variant:"h5",children:"Sign in"}),Object(O.jsxs)("form",{className:j.form,children:[Object(O.jsx)(u.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:t,onChange:function(e){return n(e.target.value)},error:r,helperText:r?"Please enter a valid email address":""}),Object(O.jsx)(u.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:i,onChange:function(e){return a(e.target.value)},error:l,helperText:l?"Please enter a password containing at least 1 special character and 8 characters":""}),Object(O.jsx)(h.a,{onClick:s,fullWidth:!0,variant:"contained",color:"primary",className:j.submit,children:"Sign In"}),Object(O.jsx)(c.a,{container:!0,children:Object(O.jsx)(c.a,{item:!0,children:Object(O.jsx)(m.a,{href:"#",variant:"body2",onClick:function(){return o(!0)},children:"Don't have an account? Sign Up"})})})]})]}),Object(O.jsx)(g.a,{mt:8})]})}var y=Object(v.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}}));function C(e){var t=e.email,n=e.changeEmail,i=e.password,a=e.changePassword,s=e.name,o=e.setName,r=e.onRegister,l=e.setFlip,j=e.emailWarn,v=e.passwordWarn,x=y();return Object(O.jsxs)(f.a,{component:"main",maxWidth:"xs",children:[Object(O.jsxs)("div",{className:x.paper,children:[Object(O.jsx)(d.a,{className:x.avatar,children:Object(O.jsx)(b.a,{})}),Object(O.jsx)(p.a,{component:"h1",variant:"h5",children:"Sign up"}),Object(O.jsxs)("form",{className:x.form,children:[Object(O.jsx)(u.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"name",label:"Name",name:"name",autoComplete:"Name",autoFocus:!0,value:s,onChange:function(e){return o(e.target.value)}}),Object(O.jsx)(u.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:t,onChange:function(e){return n(e.target.value)},error:j,helperText:j?"Please enter a valid email address":""}),Object(O.jsx)(u.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:i,onChange:function(e){return a(e.target.value)},error:v,helperText:v?"Please enter a password containing at least 1 special character and 8 characters":""}),Object(O.jsx)(h.a,{onClick:r,fullWidth:!0,variant:"contained",color:"primary",className:x.submit,children:"Sign Up"}),Object(O.jsx)(c.a,{container:!0,children:Object(O.jsx)(c.a,{item:!0,children:Object(O.jsx)(m.a,{href:"#",variant:"body2",onClick:function(){return l(!1)},children:"Already have an account? Sign In"})})})]})]}),Object(O.jsx)(g.a,{mt:8})]})}var k=n(464),N=n(465),w=n(14),A=n(202),R=n.n(A),I=n(458),T=n(28),E=n.n(T),M=n(22),F=n.n(M),B=n(40),L=n(468),U=n(467),D=n(463),W=n(457),P=n(100),V=n.n(P),J=n(459),_=n(462),z=n(461),q=n(460),H=Object(v.a)((function(e){return{icon:{marginRight:e.spacing(2)},heroContent:{backgroundColor:e.palette.background.paper,padding:e.spacing(1,0,5)},heroButtons:{marginTop:e.spacing(4)},cardGrid:{paddingTop:e.spacing(8),paddingBottom:e.spacing(8)},card:{height:"100%",display:"flex",flexDirection:"column"},cardMedia:{paddingTop:"56.25%"},cardContent:{flexGrow:1},orange:{color:e.palette.getContrastText(W.a[500]),backgroundColor:W.a[500]},extendedIcon:{marginRight:e.spacing(1)},fab:{position:"fixed",bottom:e.spacing(8),right:e.spacing(8)}}}));function K(){var e=Object(w.g)().teamSecret,t=Object(i.useState)(!1),n=Object(r.a)(t,2),a=n[0],s=n[1],o=Object(i.useState)(!1),m=Object(r.a)(o,2),g=m[0],j=m[1],b=Object(i.useState)(""),v=Object(r.a)(b,2),x=v[0],S=v[1],y=Object(i.useState)(""),C=Object(r.a)(y,2),A=C[0],R=C[1],T=Object(i.useState)([]),M=Object(r.a)(T,2),W=M[0],P=M[1],K=H(),G=Object(w.e)();Object(i.useEffect)((function(){F.a.get("token")||G.push("/"),e&&(R(e),Q())}),[G]),Object(i.useEffect)((function(){Y()}),[]);function Y(){console.log("bla");var e={method:"get",url:"/api/secure/teams/",headers:{Authorization:"Bearer ".concat(F.a.get("token"))}};E()(e).then((function(e){console.log(JSON.stringify(e.data)),P(e.data)})).catch((function(e){console.log(e)}))}var X=function(){s(!1)},Q=function(){j(!0)},Z=function(){R(""),j(!1)};return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(B.b,{to:"/vc/".concat(Math.random().toString(36).substring(7)),style:{textDecoration:"none"},target:"_blank",children:Object(O.jsxs)(I.a,{variant:"extended",className:K.fab,color:"primary",children:[Object(O.jsx)(V.a,{className:K.extendedIcon}),"Start Instant Call"]})}),Object(O.jsx)("div",{children:Object(O.jsxs)(J.a,{open:a,onClose:X,"aria-labelledby":"form-dialog-title",maxWidth:"xs",fullWidth:!0,children:[Object(O.jsx)(q.a,{id:"form-dialog-title",children:"Create New Team"}),Object(O.jsx)(z.a,{children:Object(O.jsx)(u.a,{autoFocus:!0,margin:"dense",id:"name",label:"Team Name",fullWidth:!0,value:x,onChange:function(e){return S(e.target.value)}})}),Object(O.jsxs)(_.a,{children:[Object(O.jsx)(h.a,{onClick:X,color:"primary",children:"Cancel"}),Object(O.jsx)(h.a,{onClick:function(){var e=JSON.stringify({name:x}),t={method:"put",url:"/api/secure/teams/",headers:{Authorization:"Bearer ".concat(F.a.get("token")),"Content-Type":"application/json"},data:e};E()(t).then((function(e){console.log(JSON.stringify(e.data)),s(!1),Y()})).catch((function(e){console.log(e)}))},color:"primary",children:"Create Team"})]})]})}),Object(O.jsx)("div",{children:Object(O.jsxs)(J.a,{open:g,onClose:Z,"aria-labelledby":"form-dialog-title",maxWidth:"xs",fullWidth:!0,children:[Object(O.jsx)(q.a,{id:"form-dialog-title",children:"Join existing team"}),Object(O.jsx)(z.a,{children:Object(O.jsx)(u.a,{autoFocus:!0,margin:"dense",id:"name",label:"Team Code",fullWidth:!0,value:A,onChange:function(e){return R(e.target.value)}})}),Object(O.jsxs)(_.a,{children:[Object(O.jsx)(h.a,{onClick:Z,color:"primary",children:"Cancel"}),Object(O.jsx)(h.a,{onClick:function(){var e={method:"post",url:"/api/secure/teams/".concat(A),headers:{Authorization:"Bearer ".concat(F.a.get("token"))}};E()(e).then((function(e){console.log(JSON.stringify(e.data)),j(!1),Y()})).catch((function(e){console.log(e)}))},color:"primary",children:"Join Team"})]})]})}),Object(O.jsx)(D.a,{}),Object(O.jsx)(k.a,{position:"relative",children:Object(O.jsxs)(N.a,{children:[Object(O.jsx)(c.a,{container:!0,justify:"flex-start",children:Object(O.jsx)(p.a,{variant:"h4",color:"inherit",noWrap:!0,children:"Relier"})}),Object(O.jsx)(c.a,{container:!0,justify:"flex-end",children:Object(O.jsx)(h.a,{color:"inherit",variant:"outlined",onClick:function(){F.a.remove("token"),G.push("/")},children:"Logout"})})]})}),Object(O.jsx)("main",{children:Object(O.jsx)(f.a,{className:K.cardGrid,maxWidth:"md",children:Object(O.jsxs)(c.a,{container:!0,spacing:4,children:[Object(O.jsx)(c.a,{item:!0,xs:12,sm:6,md:4,children:Object(O.jsxs)(l.a,{className:K.card,style:{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center"},children:[Object(O.jsx)(U.a,{style:{alignItems:"center",display:"flex",justifyContent:"center",paddingBottom:0},children:Object(O.jsx)(h.a,{variant:"contained",color:"primary",onClick:function(){s(!0)},children:"Create Team"})}),Object(O.jsx)(U.a,{style:{alignItems:"center",display:"flex",justifyContent:"center"},children:Object(O.jsx)(h.a,{variant:"outlined",color:"primary",onClick:Q,children:"Join Team"})})]})}),W.map((function(e){return Object(O.jsx)(c.a,{item:!0,xs:12,sm:6,md:4,children:Object(O.jsxs)(l.a,{className:K.card,hoverable:!0,children:[Object(O.jsx)("div",{style:{cursor:"pointer"},children:Object(O.jsxs)(B.b,{to:"/team/".concat(e.secret),style:{textDecoration:"none"},target:"_blank",children:[Object(O.jsx)(U.a,{style:{alignItems:"center",display:"flex",paddingBottom:0,justifyContent:"center"},children:Object(O.jsx)(d.a,{className:K.orange,variant:"square",children:e.name.substring(0,1)})}),Object(O.jsx)(U.a,{className:K.cardContent,style:{paddingBottom:0},children:Object(O.jsx)(p.a,{gutterBottom:!0,variant:"h5",component:"h2",children:e.name})})]})}),Object(O.jsx)(L.a,{children:Object(O.jsx)(h.a,{size:"small",color:"primary",onClick:function(){},children:"Leave"})})]})},e.id)}))]})})})]})}var G=n(24),Y=n(25),X=n(10),Q=n(37),Z=n(36),$=(n(273),n(203)),ee=(n(167),function(e){Object(Q.a)(n,e);var t=Object(Z.a)(n);function n(e){var i;return Object(G.a)(this,n),(i=t.call(this,e)).videoRef=a.a.createRef(),i}return Object(Y.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props&&this.props.user.streamManager&&this.videoRef&&(console.log("PROPS: ",this.props),this.props.user.getStreamManager().addVideoElement(this.videoRef.current)),this.props&&this.props.user.streamManager.session&&this.props.user&&this.videoRef&&this.props.user.streamManager.session.on("signal:userChanged",(function(t){void 0!==JSON.parse(t.data).isScreenShareActive&&e.props.user.getStreamManager().addVideoElement(e.videoRef.current)}))}},{key:"componentDidUpdate",value:function(e){e&&this.videoRef&&this.props.user.getStreamManager().addVideoElement(this.videoRef.current)}},{key:"render",value:function(){return Object(O.jsx)("video",{autoPlay:!0,id:"video-"+this.props.user.getStreamManager().stream.streamId,ref:this.videoRef,muted:this.props.mutedSound})}}]),n}(i.Component)),te=n(103),ne=n.n(te),ie=n(102),ae=n.n(ie),se=n(205),oe=n.n(se),re=n(204),ce=n.n(re),le=n(449),de=n(448),he=n(478),ue=n(469),me=n(101),ge=n.n(me),je=n(453),be=function(e){Object(Q.a)(n,e);var t=Object(Z.a)(n);function n(e){var i;return Object(G.a)(this,n),(i=t.call(this,e)).state={nickname:i.props.user.getNickname(),showForm:!1,mutedSound:!1,isFormValid:!0},i.handleChange=i.handleChange.bind(Object(X.a)(i)),i.handlePressKey=i.handlePressKey.bind(Object(X.a)(i)),i.toggleNicknameForm=i.toggleNicknameForm.bind(Object(X.a)(i)),i.toggleSound=i.toggleSound.bind(Object(X.a)(i)),i}return Object(Y.a)(n,[{key:"handleChange",value:function(e){this.setState({nickname:e.target.value}),e.preventDefault()}},{key:"toggleNicknameForm",value:function(){this.props.user.isLocal()&&this.setState({showForm:!this.state.showForm})}},{key:"toggleSound",value:function(){this.setState({mutedSound:!this.state.mutedSound})}},{key:"handlePressKey",value:function(e){"Enter"===e.key&&(console.log(this.state.nickname),this.state.nickname.length>=3&&this.state.nickname.length<=20?(this.props.handleNickname(this.state.nickname),this.toggleNicknameForm(),this.setState({isFormValid:!0})):this.setState({isFormValid:!1}))}},{key:"render",value:function(){return Object(O.jsxs)("div",{className:"OT_widget-container",children:[Object(O.jsx)("div",{className:"pointer nickname",children:this.state.showForm?Object(O.jsxs)(le.a,{id:"nicknameForm",children:[Object(O.jsx)(ue.a,{color:"inherit",id:"closeButton",onClick:this.toggleNicknameForm,children:Object(O.jsx)(ge.a,{})}),Object(O.jsx)(he.a,{htmlFor:"name-simple",id:"label",style:{padding:"10px"},children:"Nickname"}),Object(O.jsx)(de.a,{color:"inherit",id:"input",value:this.state.nickname,onChange:this.handleChange,onKeyPress:this.handlePressKey,required:!0}),!this.state.isFormValid&&this.state.nickname.length<=0&&Object(O.jsx)(je.a,{id:"name-error-text",children:"Nickname is too short!"}),!this.state.isFormValid&&this.state.nickname.length>=20&&Object(O.jsx)(je.a,{id:"name-error-text",children:"Nickname is too long!"})]}):Object(O.jsxs)("div",{style:{padding:"10px"},onClick:this.toggleNicknameForm,children:[Object(O.jsx)("span",{id:"nickname",children:this.props.user.getNickname()}),this.props.user.isLocal()&&Object(O.jsx)("span",{id:"",children:" (edit)"})]})}),void 0!==this.props.user&&void 0!==this.props.user.getStreamManager()?Object(O.jsxs)("div",{className:"streamComponent",children:[Object(O.jsx)(ee,{user:this.props.user,mutedSound:this.state.mutedSound}),Object(O.jsxs)("div",{id:"statusIcons",children:[this.props.user.isVideoActive()?null:Object(O.jsx)("div",{id:"camIcon",children:Object(O.jsx)(ae.a,{id:"statusCam"})}),this.props.user.isAudioActive()?null:Object(O.jsx)("div",{id:"micIcon",children:Object(O.jsx)(ne.a,{id:"statusMic"})})]}),Object(O.jsx)("div",{children:!this.props.user.isLocal()&&Object(O.jsx)(ue.a,{id:"volumeButton",onClick:this.toggleSound,children:this.state.mutedSound?Object(O.jsx)(ce.a,{color:"secondary"}):Object(O.jsx)(oe.a,{})})})]}):null]})}}]),n}(i.Component),pe=(n(297),function(e){Object(Q.a)(n,e);var t=Object(Z.a)(n);function n(e){var i;return Object(G.a)(this,n),(i=t.call(this,e)).openviduExtensionUrl="https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",i.state={isInstalled:!1},i.goToChromePage=i.goToChromePage.bind(Object(X.a)(i)),i.onNoClick=i.onNoClick.bind(Object(X.a)(i)),i.refreshBrowser=i.refreshBrowser.bind(Object(X.a)(i)),i}return Object(Y.a)(n,[{key:"componentWillReceiveProps",value:function(e){}},{key:"componentDidMount",value:function(){}},{key:"onNoClick",value:function(){this.props.cancelClicked()}},{key:"goToChromePage",value:function(){window.open(this.openviduExtensionUrl),this.setState({isInstalled:!0})}},{key:"refreshBrowser",value:function(){window.location.reload()}},{key:"render",value:function(){return Object(O.jsx)("div",{children:this.props&&this.props.showDialog?Object(O.jsx)("div",{id:"dialogExtension",children:Object(O.jsxs)(l.a,{id:"card",children:[Object(O.jsxs)(U.a,{children:[Object(O.jsx)(p.a,{color:"textSecondary",children:"Hello"}),Object(O.jsx)(p.a,{color:"textSecondary",children:"You need install this chrome extension and refresh the browser for can share your screen."})]}),Object(O.jsxs)(L.a,{children:[Object(O.jsx)(h.a,{size:"small",onClick:this.onNoClick,children:"Cancel"}),Object(O.jsx)(h.a,{size:"small",onClick:this.goToChromePage,children:"Install"}),this.state.isInstalled?Object(O.jsx)(h.a,{size:"small",onClick:this.refreshBrowser,children:"Refresh"}):null]})]})}):null})}}]),n}(i.Component)),ve=n(104),fe=n.n(ve),Oe=(n(298),n(479)),xe=function(e){Object(Q.a)(n,e);var t=Object(Z.a)(n);function n(e){var i;return Object(G.a)(this,n),(i=t.call(this,e)).state={messageList:[],message:""},i.chatScroll=a.a.createRef(),i.handleChange=i.handleChange.bind(Object(X.a)(i)),i.handlePressKey=i.handlePressKey.bind(Object(X.a)(i)),i.close=i.close.bind(Object(X.a)(i)),i.sendMessage=i.sendMessage.bind(Object(X.a)(i)),i}return Object(Y.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.user.getStreamManager().stream.session.on("signal:chat",(function(t){var n=JSON.parse(t.data),i=e.state.messageList;i.push({connectionId:t.from.connectionId,nickname:n.nickname,message:n.message});var a=window.document;setTimeout((function(){var t=a.getElementById("userImg-"+(e.state.messageList.length-1)),i=a.getElementById("video-"+n.streamId);t.getContext("2d").drawImage(i,200,120,285,285,0,0,60,60),e.props.messageReceived()}),50),e.setState({messageList:i}),e.scrollToBottom()}))}},{key:"handleChange",value:function(e){this.setState({message:e.target.value})}},{key:"handlePressKey",value:function(e){"Enter"===e.key&&this.sendMessage()}},{key:"sendMessage",value:function(){if(console.log(this.state.message),this.props.user&&this.state.message){var e=this.state.message.replace(/ +(?= )/g,"");if(""!==e&&" "!==e){var t={message:e,nickname:this.props.user.getNickname(),streamId:this.props.user.getStreamManager().stream.streamId};this.props.user.getStreamManager().stream.session.signal({data:JSON.stringify(t),type:"chat"})}}this.setState({message:""})}},{key:"scrollToBottom",value:function(){var e=this;setTimeout((function(){try{e.chatScroll.current.scrollTop=e.chatScroll.current.scrollHeight}catch(t){}}),20)}},{key:"close",value:function(){this.props.close(void 0)}},{key:"render",value:function(){var e=this,t={display:this.props.chatDisplay};return Object(O.jsx)("div",{id:"chatContainer",children:Object(O.jsxs)("div",{id:"chatComponent",style:t,children:[Object(O.jsxs)("div",{id:"chatToolbar",children:[Object(O.jsxs)("span",{children:[this.props.user.getStreamManager().stream.session.sessionId," - CHAT"]}),Object(O.jsx)(ue.a,{id:"closeButton",onClick:this.close,children:Object(O.jsx)(ge.a,{color:"secondary"})})]}),Object(O.jsx)("div",{className:"message-wrap",ref:this.chatScroll,children:this.state.messageList.map((function(t,n){return Object(O.jsxs)("div",{id:"remoteUsers",className:"message"+(t.connectionId!==e.props.user.getConnectionId()?" left":" right"),children:[Object(O.jsx)("canvas",{id:"userImg-"+n,width:"60",height:"60",className:"user-img"}),Object(O.jsxs)("div",{className:"msg-detail",children:[Object(O.jsx)("div",{className:"msg-info",children:Object(O.jsxs)("p",{children:[" ",t.nickname]})}),Object(O.jsxs)("div",{className:"msg-content",children:[Object(O.jsx)("span",{className:"triangle"}),Object(O.jsx)("p",{className:"text",children:t.message})]})]})]},n)}))}),Object(O.jsxs)("div",{id:"messageInput",children:[Object(O.jsx)("input",{placeholder:"Send a messge",id:"chatInput",value:this.state.message,onChange:this.handleChange,onKeyPress:this.handlePressKey}),Object(O.jsx)(Oe.a,{title:"Send message",children:Object(O.jsx)(I.a,{size:"small",id:"sendButton",onClick:this.sendMessage,children:Object(O.jsx)(fe.a,{})})})]})]})})}}]),n}(i.Component),Se=n(54),ye=n.n(Se),Ce=function(){function e(){Object(G.a)(this,e)}return Object(Y.a)(e,[{key:"fixAspectRatio",value:function(e,t){var n=e.querySelector(".OT_root");if(n){var i=n.style.width;n.style.width=t+"px",n.style.width=i||""}}},{key:"positionElement",value:function(e,t,n,i,a,s){var o=this,r={left:t+"px",top:n+"px",width:i+"px",height:a+"px"};this.fixAspectRatio(e,i),s&&ye.a?(ye()(e).stop(),ye()(e).animate(r,s.duration||200,s.easing||"swing",(function(){o.fixAspectRatio(e,i),s.complete&&s.complete.call(o)}))):ye()(e).css(r),this.fixAspectRatio(e,i)}},{key:"getVideoRatio",value:function(e){if(!e)return 3/4;var t=e.querySelector("video");return t&&t.videoHeight&&t.videoWidth?t.videoHeight/t.videoWidth:e.videoHeight&&e.videoWidth?e.videoHeight/e.videoWidth:3/4}},{key:"getCSSNumber",value:function(e,t){var n=ye()(e).css(t);return n?parseInt(n,10):0}},{key:"cheapUUID",value:function(){return(1e8*Math.random()).toFixed(0)}},{key:"getHeight",value:function(e){var t=ye()(e).css("height");return t?parseInt(t,10):0}},{key:"getWidth",value:function(e){var t=ye()(e).css("width");return t?parseInt(t,10):0}},{key:"getBestDimensions",value:function(e,t,n,i,a,s){for(var o,r,c,l,d,h,u,m=1;m<=n;m++){var g=m,j=Math.ceil(n/g);(u=(h=Math.floor(a/j))/(d=Math.floor(i/g)))>t?h=d*(u=t):u<e&&(d=h/(u=e));var b=d*h*n;(void 0===o||b>o)&&(o=b,s=h,l=d,r=g,c=j)}return{maxArea:o,targetCols:r,targetRows:c,targetHeight:s,targetWidth:l,ratio:s/l}}},{key:"arrange",value:function(e,t,n,i,a,s,o,r,c){var l,d,h=e.length;if(s){var u=this.getVideoRatio(e.length>0?e[0]:null);d=this.getBestDimensions(u,u,h,t,n,l)}else d=this.getBestDimensions(o,r,h,t,n,l);for(var m,g=0,j=0,b=[],p=0;p<e.length;p++){p%d.targetCols===0&&(m={children:[],width:0,height:0},b.push(m));var v=e[p];m.children.push(v);var f=d.targetWidth;l=d.targetHeight,s&&(f=l/this.getVideoRatio(v)),m.width+=f,m.height=l}for(var O=0,x=0,S=0;S<b.length;S++)(m=b[S]).width>t?(m.height=Math.floor(m.height*(t/m.width)),m.width=t):m.width<t&&(x+=1),O+=m.height;if(O<n&&x>0){var y=n-O;O=0;for(var C=0;C<b.length;C++){if((m=b[C]).width<t){var k=y/x;k/m.height>(t-m.width)/m.width&&(k=Math.floor((t-m.width)/m.width*m.height)),m.width+=Math.floor(k/m.height*m.width),m.height+=k,y-=k,x-=1}O+=m.height}}j=(n-O)/2;for(var N=0;N<b.length;N++){g=(t-(m=b[N]).width)/2;for(var w=0;w<m.children.length;w++){var A=m.children[w],R=d.targetWidth;l=m.height,s&&(R=Math.floor(l/this.getVideoRatio(A))),A.style.position="absolute";var I=R-this.getCSSNumber(A,"paddingLeft")-this.getCSSNumber(A,"paddingRight")-this.getCSSNumber(A,"marginLeft")-this.getCSSNumber(A,"marginRight")-this.getCSSNumber(A,"borderLeft")-this.getCSSNumber(A,"borderRight"),T=l-this.getCSSNumber(A,"paddingTop")-this.getCSSNumber(A,"paddingBottom")-this.getCSSNumber(A,"marginTop")-this.getCSSNumber(A,"marginBottom")-this.getCSSNumber(A,"borderTop")-this.getCSSNumber(A,"borderBottom");this.positionElement(A,g+i,j+a,I,T,c),g+=R}j+=l}}},{key:"filterDisplayNone",value:function(e){return"none"!==e.style.display}},{key:"updateLayout",value:function(){if("none"!==this.layoutContainer.style.display){var e=this.layoutContainer.id;e||(e="OT_"+this.cheapUUID(),this.layoutContainer.id=e);var t,n,i=this.getHeight(this.layoutContainer)-this.getCSSNumber(this.layoutContainer,"borderTop")-this.getCSSNumber(this.layoutContainer,"borderBottom"),a=this.getWidth(this.layoutContainer)-this.getCSSNumber(this.layoutContainer,"borderLeft")-this.getCSSNumber(this.layoutContainer,"borderRight"),s=i/a,o=0,r=0,c=0,l=0,d=Array.prototype.filter.call(this.layoutContainer.querySelectorAll("#"+e+">."+this.opts.bigClass),this.filterDisplayNone),h=Array.prototype.filter.call(this.layoutContainer.querySelectorAll("#"+e+">*:not(."+this.opts.bigClass+")"),this.filterDisplayNone);if(d.length>0&&h.length>0)s>this.getVideoRatio(d[0])?(t=a,c=i-(r=n=Math.floor(i*this.opts.bigPercentage))):(n=i,l=a-(o=t=Math.floor(a*this.opts.bigPercentage))),this.opts.bigFirst?(this.arrange(d,t,n,0,0,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate),this.arrange(h,a-o,i-r,o,r,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate)):(this.arrange(h,a-o,i-r,0,0,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate),this.arrange(d,t,n,l,c,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate));else d.length>0&&0===h.length?this.arrange(d,a,i,0,0,this.opts.bigFixedRatio,this.opts.bigMinRatio,this.opts.bigMaxRatio,this.opts.animate):this.arrange(h,a-o,i-r,o,r,this.opts.fixedRatio,this.opts.minRatio,this.opts.maxRatio,this.opts.animate)}}},{key:"initLayoutContainer",value:function(e,t){this.opts={maxRatio:null!=t.maxRatio?t.maxRatio:1.5,minRatio:null!=t.minRatio?t.minRatio:9/16,fixedRatio:null!=t.fixedRatio&&t.fixedRatio,animate:null!=t.animate&&t.animate,bigClass:null!=t.bigClass?t.bigClass:"OT_big",bigPercentage:null!=t.bigPercentage?t.bigPercentage:.8,bigFixedRatio:null!=t.bigFixedRatio&&t.bigFixedRatio,bigMaxRatio:null!=t.bigMaxRatio?t.bigMaxRatio:1.5,bigMinRatio:null!=t.bigMinRatio?t.bigMinRatio:9/16,bigFirst:null==t.bigFirst||t.bigFirst},this.layoutContainer="string"===typeof e?ye()(e):e}},{key:"setLayoutOptions",value:function(e){this.opts=e}}]),e}(),ke=function(){function e(){Object(G.a)(this,e),this.connectionId="",this.audioActive=!0,this.videoActive=!0,this.screenShareActive=!1,this.nickname="",this.streamManager=null,this.type="local"}return Object(Y.a)(e,[{key:"isAudioActive",value:function(){return this.audioActive}},{key:"isVideoActive",value:function(){return this.videoActive}},{key:"isScreenShareActive",value:function(){return this.screenShareActive}},{key:"getConnectionId",value:function(){return this.connectionId}},{key:"getNickname",value:function(){return this.nickname}},{key:"getStreamManager",value:function(){return this.streamManager}},{key:"isLocal",value:function(){return"local"===this.type}},{key:"isRemote",value:function(){return!this.isLocal()}},{key:"setAudioActive",value:function(e){this.audioActive=e}},{key:"setVideoActive",value:function(e){this.videoActive=e}},{key:"setScreenShareActive",value:function(e){this.screenShareActive=e}},{key:"setStreamManager",value:function(e){this.streamManager=e}},{key:"setConnectionId",value:function(e){this.connectionId=e}},{key:"setNickname",value:function(e){this.nickname=e}},{key:"setType",value:function(e){"local"===e|"remote"===e&&(this.type=e)}}]),e}(),Ne=n(207),we=n.n(Ne),Ae=n(105),Re=n.n(Ae),Ie=n(208),Te=n.n(Ie),Ee=n(209),Me=n.n(Ee),Fe=n(210),Be=n.n(Fe),Le=n(211),Ue=n.n(Le),De=n(212),We=n.n(De),Pe=function(e){Object(Q.a)(n,e);var t=Object(Z.a)(n);function n(e){var i;return Object(G.a)(this,n),(i=t.call(this,e)).state={fullscreen:!1},i.camStatusChanged=i.camStatusChanged.bind(Object(X.a)(i)),i.micStatusChanged=i.micStatusChanged.bind(Object(X.a)(i)),i.screenShare=i.screenShare.bind(Object(X.a)(i)),i.stopScreenShare=i.stopScreenShare.bind(Object(X.a)(i)),i.toggleFullscreen=i.toggleFullscreen.bind(Object(X.a)(i)),i.leaveSession=i.leaveSession.bind(Object(X.a)(i)),i.toggleChat=i.toggleChat.bind(Object(X.a)(i)),i}return Object(Y.a)(n,[{key:"micStatusChanged",value:function(){this.props.micStatusChanged()}},{key:"camStatusChanged",value:function(){this.props.camStatusChanged()}},{key:"screenShare",value:function(){this.props.screenShare()}},{key:"stopScreenShare",value:function(){this.props.stopScreenShare()}},{key:"toggleFullscreen",value:function(){this.setState({fullscreen:!this.state.fullscreen}),this.props.toggleFullscreen()}},{key:"leaveSession",value:function(){this.props.leaveSession()}},{key:"toggleChat",value:function(){this.props.toggleChat()}},{key:"render",value:function(){this.props.sessionId;var e=this.props.user;return Object(O.jsx)(k.a,{className:"toolbar",id:"header",children:Object(O.jsxs)(N.a,{className:"toolbar",children:[Object(O.jsx)("div",{id:"navSessionInfo",children:this.props.sessionId&&Object(O.jsx)("div",{id:"titleContent",children:Object(O.jsx)(h.a,{children:"Invite"})})}),Object(O.jsxs)("div",{className:"buttonsContent",children:[Object(O.jsx)(ue.a,{color:"inherit",className:"navButton",id:"navMicButton",onClick:this.micStatusChanged,children:void 0!==e&&e.isAudioActive()?Object(O.jsx)(we.a,{}):Object(O.jsx)(ne.a,{color:"secondary"})}),Object(O.jsx)(ue.a,{color:"inherit",className:"navButton",id:"navCamButton",onClick:this.camStatusChanged,children:void 0!==e&&e.isVideoActive()?Object(O.jsx)(Re.a,{}):Object(O.jsx)(ae.a,{color:"secondary"})}),Object(O.jsx)(ue.a,{color:"inherit",className:"navButton",onClick:this.screenShare,children:void 0!==e&&e.isScreenShareActive()?Object(O.jsx)(Te.a,{}):Object(O.jsx)(Me.a,{})}),void 0!==e&&e.isScreenShareActive()&&Object(O.jsx)(ue.a,{onClick:this.stopScreenShare,id:"navScreenButton",children:Object(O.jsx)(Be.a,{color:"secondary"})}),Object(O.jsx)(ue.a,{color:"secondary",className:"navButton",onClick:this.leaveSession,id:"navLeaveButton",children:Object(O.jsx)(Ue.a,{})}),Object(O.jsxs)(ue.a,{color:"inherit",onClick:this.toggleChat,id:"navChatButton",style:{top:"0"},children:[this.props.showNotification&&Object(O.jsx)("div",{id:"point",className:""}),Object(O.jsx)(Oe.a,{title:"Chat",children:Object(O.jsx)(We.a,{})})]})]})]})})}}]),n}(i.Component),Ve=new ke,Je=function(e){Object(Q.a)(n,e);var t=Object(Z.a)(n);function n(e){var i;Object(G.a)(this,n),(i=t.call(this,e)).OPENVIDU_SERVER_URL=i.props.openviduServerUrl?i.props.openviduServerUrl:"https://"+window.location.hostname+":4443",i.OPENVIDU_SERVER_SECRET=i.props.openviduSecret?i.props.openviduSecret:"MY_SECRET",i.hasBeenUpdated=!1,i.layout=new Ce;var a=i.props.sessionName?i.props.sessionName:"new",s=i.props.user?i.props.user:"OpenVidu_User"+Math.floor(100*Math.random());return i.remotes=[],i.localUserAccessAllowed=!1,i.state={mySessionId:a,myUserName:s,session:a,localUser:void 0,subscribers:[],chatDisplay:"none"},i.joinSession=i.joinSession.bind(Object(X.a)(i)),i.leaveSession=i.leaveSession.bind(Object(X.a)(i)),i.onbeforeunload=i.onbeforeunload.bind(Object(X.a)(i)),i.updateLayout=i.updateLayout.bind(Object(X.a)(i)),i.camStatusChanged=i.camStatusChanged.bind(Object(X.a)(i)),i.micStatusChanged=i.micStatusChanged.bind(Object(X.a)(i)),i.nicknameChanged=i.nicknameChanged.bind(Object(X.a)(i)),i.toggleFullscreen=i.toggleFullscreen.bind(Object(X.a)(i)),i.screenShare=i.screenShare.bind(Object(X.a)(i)),i.stopScreenShare=i.stopScreenShare.bind(Object(X.a)(i)),i.closeDialogExtension=i.closeDialogExtension.bind(Object(X.a)(i)),i.toggleChat=i.toggleChat.bind(Object(X.a)(i)),i.checkNotification=i.checkNotification.bind(Object(X.a)(i)),i.checkSize=i.checkSize.bind(Object(X.a)(i)),i}return Object(Y.a)(n,[{key:"componentDidMount",value:function(){this.layout.initLayoutContainer(document.getElementById("layout"),{maxRatio:1.5,minRatio:9/16,fixedRatio:!1,bigClass:"OV_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16,bigFirst:!0,animate:!0}),window.addEventListener("beforeunload",this.onbeforeunload),window.addEventListener("resize",this.updateLayout),window.addEventListener("resize",this.checkSize),this.joinSession()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.onbeforeunload),window.removeEventListener("resize",this.updateLayout),window.removeEventListener("resize",this.checkSize),this.leaveSession()}},{key:"onbeforeunload",value:function(e){this.leaveSession()}},{key:"joinSession",value:function(){var e=this;this.OV=new $.OpenVidu,this.setState({session:this.OV.initSession()},(function(){e.subscribeToStreamCreated(),e.connectToSession()}))}},{key:"connectToSession",value:function(){var e=this;void 0!==this.props.token?(console.log("token received: ",this.props.token),this.connect(this.props.token)):this.getToken().then((function(t){console.log(t),e.connect(t)})).catch((function(t){e.props.error&&e.props.error({error:t.error,messgae:t.message,code:t.code,status:t.status}),console.log("There was an error getting the token:",t.code,t.message),alert("There was an error getting the token:",t.message)}))}},{key:"connect",value:function(e){var t=this;this.state.session.connect(e,{clientData:this.state.myUserName}).then((function(){t.connectWebCam()})).catch((function(e){t.props.error&&t.props.error({error:e.error,messgae:e.message,code:e.code,status:e.status}),alert("There was an error connecting to the session:",e.message),console.log("There was an error connecting to the session:",e.code,e.message)}))}},{key:"connectWebCam",value:function(){var e=this,t=this.OV.initPublisher(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:Ve.isAudioActive(),publishVideo:Ve.isVideoActive(),resolution:"640x480",frameRate:30,insertMode:"APPEND"});this.state.session.capabilities.publish&&t.on("accessAllowed",(function(){e.state.session.publish(t).then((function(){e.updateSubscribers(),e.localUserAccessAllowed=!0,e.props.joinSession&&e.props.joinSession()}))})),Ve.setNickname(this.state.myUserName),Ve.setConnectionId(this.state.session.connection.connectionId),Ve.setScreenShareActive(!1),Ve.setStreamManager(t),this.subscribeToUserChanged(),this.subscribeToStreamDestroyed(),this.sendSignalUserChanged({isScreenShareActive:Ve.isScreenShareActive()}),this.setState({localUser:Ve},(function(){e.state.localUser.getStreamManager().on("streamPlaying",(function(n){e.updateLayout(),t.videos[0].video.parentElement.classList.remove("custom-class")}))}))}},{key:"updateSubscribers",value:function(){var e=this,t=this.remotes;this.setState({subscribers:t},(function(){e.state.localUser&&e.sendSignalUserChanged({isAudioActive:e.state.localUser.isAudioActive(),isVideoActive:e.state.localUser.isVideoActive(),nickname:e.state.localUser.getNickname(),isScreenShareActive:e.state.localUser.isScreenShareActive()}),e.updateLayout()}))}},{key:"leaveSession",value:function(){var e=this.state.session;e&&e.disconnect(),this.OV=null,this.setState({session:void 0,subscribers:[],mySessionId:"SessionA",myUserName:"OpenVidu_User"+Math.floor(100*Math.random()),localUser:void 0}),this.props.leaveSession&&this.props.leaveSession()}},{key:"camStatusChanged",value:function(){Ve.setVideoActive(!Ve.isVideoActive()),Ve.getStreamManager().publishVideo(Ve.isVideoActive()),this.sendSignalUserChanged({isVideoActive:Ve.isVideoActive()}),this.setState({localUser:Ve})}},{key:"micStatusChanged",value:function(){Ve.setAudioActive(!Ve.isAudioActive()),Ve.getStreamManager().publishAudio(Ve.isAudioActive()),this.sendSignalUserChanged({isAudioActive:Ve.isAudioActive()}),this.setState({localUser:Ve})}},{key:"nicknameChanged",value:function(e){var t=this.state.localUser;t.setNickname(e),this.setState({localUser:t}),this.sendSignalUserChanged({nickname:this.state.localUser.getNickname()})}},{key:"deleteSubscriber",value:function(e){var t=this.state.subscribers,n=t.filter((function(t){return t.getStreamManager().stream===e}))[0],i=t.indexOf(n,0);i>-1&&(t.splice(i,1),this.setState({subscribers:t}))}},{key:"subscribeToStreamCreated",value:function(){var e=this;this.state.session.on("streamCreated",(function(t){var n=e.state.session.subscribe(t.stream,void 0);n.on("streamPlaying",(function(t){e.checkSomeoneShareScreen(),n.videos[0].video.parentElement.classList.remove("custom-class")}));var i=new ke;i.setStreamManager(n),i.setConnectionId(t.stream.connection.connectionId),i.setType("remote");var a=t.stream.connection.data.split("%")[0];i.setNickname(JSON.parse(a).clientData),e.remotes.push(i),e.localUserAccessAllowed&&e.updateSubscribers()}))}},{key:"subscribeToStreamDestroyed",value:function(){var e=this;this.state.session.on("streamDestroyed",(function(t){e.deleteSubscriber(t.stream),setTimeout((function(){e.checkSomeoneShareScreen()}),20),t.preventDefault(),e.updateLayout()}))}},{key:"subscribeToUserChanged",value:function(){var e=this;this.state.session.on("signal:userChanged",(function(t){var n=e.state.subscribers;n.forEach((function(e){if(e.getConnectionId()===t.from.connectionId){var n=JSON.parse(t.data);console.log("EVENTO REMOTE: ",t.data),void 0!==n.isAudioActive&&e.setAudioActive(n.isAudioActive),void 0!==n.isVideoActive&&e.setVideoActive(n.isVideoActive),void 0!==n.nickname&&e.setNickname(n.nickname),void 0!==n.isScreenShareActive&&e.setScreenShareActive(n.isScreenShareActive)}})),e.setState({subscribers:n},(function(){return e.checkSomeoneShareScreen()}))}))}},{key:"updateLayout",value:function(){var e=this;setTimeout((function(){e.layout.updateLayout()}),20)}},{key:"sendSignalUserChanged",value:function(e){var t={data:JSON.stringify(e),type:"userChanged"};this.state.session.signal(t)}},{key:"toggleFullscreen",value:function(){var e=window.document,t=e.getElementById("container");e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}},{key:"screenShare",value:function(){var e=this,t=-1!==navigator.userAgent.indexOf("Firefox")?"window":"screen",n=this.OV.initPublisher(void 0,{videoSource:t,publishAudio:Ve.isAudioActive(),publishVideo:Ve.isVideoActive(),mirror:!1},(function(t){t&&"SCREEN_EXTENSION_NOT_INSTALLED"===t.name?e.setState({showExtensionDialog:!0}):t&&"SCREEN_SHARING_NOT_SUPPORTED"===t.name?alert("Your browser does not support screen sharing"):t&&"SCREEN_EXTENSION_DISABLED"===t.name?alert("You need to enable screen sharing extension"):t&&"SCREEN_CAPTURE_DENIED"===t.name&&alert("You need to choose a window or application to share")}));n.once("accessAllowed",(function(){e.state.session.unpublish(Ve.getStreamManager()),Ve.setStreamManager(n),e.state.session.publish(Ve.getStreamManager()).then((function(){Ve.setScreenShareActive(!0),e.setState({localUser:Ve},(function(){e.sendSignalUserChanged({isScreenShareActive:Ve.isScreenShareActive()})}))}))})),n.on("streamPlaying",(function(){e.updateLayout(),n.videos[0].video.parentElement.classList.remove("custom-class")}))}},{key:"closeDialogExtension",value:function(){this.setState({showExtensionDialog:!1})}},{key:"stopScreenShare",value:function(){this.state.session.unpublish(Ve.getStreamManager()),this.connectWebCam()}},{key:"checkSomeoneShareScreen",value:function(){var e={maxRatio:1.5,minRatio:9/16,fixedRatio:this.state.subscribers.some((function(e){return e.isScreenShareActive()}))||Ve.isScreenShareActive(),bigClass:"OV_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16,bigFirst:!0,animate:!0};this.layout.setLayoutOptions(e),this.updateLayout()}},{key:"toggleChat",value:function(e){var t=e;void 0===t&&(t="none"===this.state.chatDisplay?"block":"none"),"block"===t?this.setState({chatDisplay:t,messageReceived:!1}):(console.log("chat",t),this.setState({chatDisplay:t})),this.updateLayout()}},{key:"checkNotification",value:function(e){this.setState({messageReceived:"none"===this.state.chatDisplay})}},{key:"checkSize",value:function(){document.getElementById("layout").offsetWidth<=700&&!this.hasBeenUpdated&&(this.toggleChat("none"),this.hasBeenUpdated=!0),document.getElementById("layout").offsetWidth>700&&this.hasBeenUpdated&&(this.hasBeenUpdated=!1)}},{key:"render",value:function(){var e=this.state.mySessionId,t=this.state.localUser,n={display:this.state.chatDisplay};return Object(O.jsxs)("div",{className:"container",id:"container",children:[Object(O.jsx)(Pe,{sessionId:e,user:t,showNotification:this.state.messageReceived,camStatusChanged:this.camStatusChanged,micStatusChanged:this.micStatusChanged,screenShare:this.screenShare,stopScreenShare:this.stopScreenShare,toggleFullscreen:this.toggleFullscreen,leaveSession:this.leaveSession,toggleChat:this.toggleChat}),Object(O.jsx)(pe,{showDialog:this.state.showExtensionDialog,cancelClicked:this.closeDialogExtension}),Object(O.jsxs)("div",{id:"layout",className:"bounds",children:[void 0!==t&&void 0!==t.getStreamManager()&&Object(O.jsx)("div",{className:"OT_root OT_publisher custom-class",id:"localUser",children:Object(O.jsx)(be,{user:t,handleNickname:this.nicknameChanged})}),this.state.subscribers.map((function(e,t){return Object(O.jsx)("div",{className:"OT_root OT_publisher custom-class",id:"remoteUsers",children:Object(O.jsx)(be,{user:e,streamId:e.streamManager.stream.streamId})},t)})),void 0!==t&&void 0!==t.getStreamManager()&&Object(O.jsx)("div",{className:"OT_root OT_publisher custom-class",style:n,children:Object(O.jsx)(xe,{user:t,chatDisplay:this.state.chatDisplay,close:this.toggleChat,messageReceived:this.checkNotification})})]})]})}},{key:"getToken",value:function(){var e=this;return this.createSession(this.state.mySessionId).then((function(t){return e.createToken(t)}))}},{key:"createSession",value:function(e){return new Promise((function(t,n){var i={method:"post",url:"/api/video/create",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTQsIm5hbWUiOiJNZWV0IFNoYWgiLCJpYXQiOjE2MjQ2NTE1MDd9.7prfxCA4FKaFL2L_LcTG9qEuy6h6CiJVSDyqGRS6H8s","Content-Type":"application/json"},data:JSON.stringify({customSessionId:e})};E()(i).then((function(e){console.log("CREATE SESION",e),t(e.data.session_id)})).catch((function(e){console.log(e)}))}))}},{key:"createToken",value:function(e){return new Promise((function(t,n){JSON.stringify({});var i={method:"post",url:"/api/vc/"+e,headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTMsIm5hbWUiOiJNZWV0IFNoYWgiLCJpYXQiOjE2MjQ1NzkwMzR9.nWWp1uzyrWGn4Sfl2ro_r3UxDiH6gxHexRLW2vzyamc"}};E()(i).then((function(e){console.log(JSON.stringify(e.data)),console.log("TOKEN",e),t(e.data.token)})).catch((function(e){console.log(e)}))}))}}]),n}(i.Component);function _e(){var e=Object(w.g)().sid;return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(Je,{sessionName:e}),Object(O.jsx)("h1",{children:e})]})}var ze=n(63),qe=n.n(ze),He=n(219),Ke=n(106),Ge=n(213),Ye=n(4),Xe=n(480),Qe=n(452),Ze=n(473),$e=n(216),et=n.n($e),tt=n(215),nt=n.n(tt),it=n(470),at=n(471),st=n(472),ot=n(217),rt=n.n(ot),ct=n(218),lt=n.n(ct),dt=n(139),ht=n(474),ut=n(214),mt=n(138),gt=Object(v.a)((function(e){return{root:{display:"flex"},orange:{color:e.palette.getContrastText(W.a[500]),backgroundColor:W.a[500]},toolbar:{paddingRight:24},toolbarIcon:Object(Ge.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 8px"},e.mixins.toolbar),appBar:{zIndex:e.zIndex.drawer+1,transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{marginLeft:240,width:"calc(100% - ".concat(240,"px)"),transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},menuButton:{marginRight:36},menuButtonHidden:{display:"none"},title:{flexGrow:1},drawerPaper:{position:"relative",height:"100vh",whiteSpace:"nowrap",width:240,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen}),overflowX:"hidden"},drawerPaperClose:Object(Ke.a)({overflowX:"hidden",position:"relative",height:"100vh",transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),width:e.spacing(7)},e.breakpoints.up("sm"),{width:e.spacing(9)}),appBarSpacer:e.mixins.toolbar,content:{flexGrow:1,height:"100vh",overflow:"auto"},container:{paddingTop:e.spacing(4),paddingBottom:e.spacing(4),maxWidth:900},paper:{padding:e.spacing(2),display:"flex",overflow:"auto",flexDirection:"column"},fixedHeight:{height:240},bottomToolbar:{position:"absolute",paddingTop:"0",bottom:"0",left:"0",width:240,background:"#fafafa"}}})),jt=Object(ut.io)().connect();function bt(){var e=Object(w.e)(),t=Object(w.g)().secret,n=Object(i.useRef)(""),s=Object(i.useState)([]),o=Object(r.a)(s,2),l=o[0],m=o[1],g=Object(i.useState)([]),j=Object(r.a)(g,2),b=j[0],v=j[1],x=gt(),S=a.a.useState(!0),y=Object(r.a)(S,2),C=y[0],A=y[1],R=Object(i.useState)(),I=Object(r.a)(R,2),T=I[0],M=I[1],L=Object(i.useState)(!1),U=Object(r.a)(L,2),W=U[0],P=U[1],H=Object(i.useState)(!1),K=Object(r.a)(H,2),G=K[0],Y=K[1],X=Object(i.useState)(""),Q=Object(r.a)(X,2),Z=Q[0],$=Q[1];Object(i.useEffect)((function(){F.a.get("token")||e.push("/"),console.log(jt),jt.on("message",(function(e){console.log(e.message),m((function(t){return[].concat(Object(He.a)(t),[e.message])}));var t=document.getElementById("main-container");t.scrollTop=t.scrollHeight})),ie()}),[]);var ee=function(){P(!1)},te=function(){Y(!1)};function ne(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.log(n.current.value),console.log(jt);var t,i=new Date;t=e?{text:"/vc/".concat(Math.random().toString(36).substring(7)),timestamp:new Date(i.getTime()+198e5).toUTCString(),is_vc:e,sender:{name:Object(mt.a)(F.a.get("token")).name}}:{text:n.current.value,timestamp:new Date(i.getTime()+198e5).toUTCString(),is_vc:e,sender:{name:Object(mt.a)(F.a.get("token")).name}},console.log(t+":"+T),jt.emit("send",{room:T,message:t});var a=JSON.stringify({text:t.text,is_vc:e});n.current.value="";var s={method:"put",url:"/api/secure/messages/".concat(T),headers:{Authorization:"Bearer ".concat(F.a.get("token")),"Content-Type":"application/json"},data:a};E()(s).then((function(e){console.log(JSON.stringify(e.data))})).catch((function(e){console.log(e)}))}function ie(){var e={method:"get",url:"/api/secure/channels/".concat(t),headers:{Authorization:"Bearer ".concat(F.a.get("token"))}};E()(e).then((function(e){console.log(JSON.stringify(e.data)),v(e.data),ae(e.data[0].secret)})).catch((function(e){console.log(e)}))}function ae(e){console.log(e),T&&(jt.emit("unsubscribe",T),document.getElementById(T).style.backgroundColor=""),M(e),document.getElementById(e).style.backgroundColor="grey",jt.emit("subscribe",e),function(e){console.log(e);var t={method:"get",url:"/api/secure/messages/".concat(e),headers:{Authorization:"Bearer ".concat(F.a.get("token"))}};E()(t).then((function(e){console.log(JSON.stringify(e.data)),m(e.data);var t=document.getElementById("main-container");t.scrollTop=t.scrollHeight})).catch((function(e){console.log(e)}))}(e)}return Object(O.jsxs)("div",{className:x.root,children:[Object(O.jsx)("div",{children:Object(O.jsxs)(J.a,{open:W,onClose:ee,"aria-labelledby":"form-dialog-title",maxWidth:"xs",fullWidth:!0,children:[Object(O.jsx)(q.a,{id:"form-dialog-title",children:"Create New Channel"}),Object(O.jsx)(z.a,{children:Object(O.jsx)(u.a,{autoFocus:!0,margin:"dense",id:"name",label:"Team Name",fullWidth:!0,value:Z,onChange:function(e){return $(e.target.value)}})}),Object(O.jsxs)(_.a,{children:[Object(O.jsx)(h.a,{onClick:ee,color:"primary",children:"Cancel"}),Object(O.jsx)(h.a,{onClick:function(){ee();var e=JSON.stringify({name:Z}),n={method:"put",url:"/api/secure/channels/".concat(t),headers:{Authorization:"Bearer ".concat(F.a.get("token")),"Content-Type":"application/json"},data:e};E()(n).then((function(e){console.log(JSON.stringify(e.data)),ie()})).catch((function(e){console.log(e)}))},color:"primary",children:"Create Channel"})]})]})}),Object(O.jsx)("div",{children:Object(O.jsxs)(J.a,{open:G,onClose:te,"aria-labelledby":"form-dialog-title",maxWidth:"xs",fullWidth:!0,children:[Object(O.jsx)(q.a,{id:"form-dialog-title",children:"Invite to team"}),Object(O.jsxs)(z.a,{style:{justifyItems:"center"},children:[Object(O.jsx)(h.a,{onClick:function(){te();var e=window.location.toString();navigator.clipboard.writeText(e.replace("team","home"))},color:"primary",children:"Copy magic link"}),Object(O.jsx)(h.a,{onClick:function(){te(),navigator.clipboard.writeText(t)},color:"secondary",style:{paddingLeft:12},children:"Copy team code"})]}),Object(O.jsx)(_.a,{children:Object(O.jsx)(h.a,{onClick:te,color:"primary",children:"Done"})})]})}),Object(O.jsx)(D.a,{}),Object(O.jsx)(k.a,{position:"absolute",className:Object(Ye.a)(x.appBar,C&&x.appBarShift),children:Object(O.jsxs)(N.a,{className:x.toolbar,children:[Object(O.jsx)(ue.a,{edge:"start",color:"inherit","aria-label":"open drawer",onClick:function(){A(!0)},className:Object(Ye.a)(x.menuButton,C&&x.menuButtonHidden),children:Object(O.jsx)(nt.a,{})}),Object(O.jsx)(p.a,{component:"h1",variant:"h4",color:"inherit",noWrap:!0,className:x.title,children:"Relier"})]})}),Object(O.jsxs)(Xe.a,{variant:"permanent",classes:{paper:Object(Ye.a)(x.drawerPaper,!C&&x.drawerPaperClose)},open:C,children:[Object(O.jsx)(Qe.a,{children:Object(O.jsxs)(it.a,{button:!0,children:[Object(O.jsx)(at.a,{onClick:function(){A(!1)},children:Object(O.jsx)(et.a,{})}),Object(O.jsx)(st.a,{primary:"Team name"})]})}),Object(O.jsx)(Ze.a,{}),Object(O.jsx)(Qe.a,{style:{height:"calc(100vh-179px}",overflowY:"auto",overflowX:"hidden"},children:Object(O.jsx)("div",{children:b.map((function(e){return Object(O.jsxs)(it.a,{button:!0,id:e.secret,onClick:function(e){ae(e.currentTarget.id)},children:[Object(O.jsx)(at.a,{children:Object(O.jsx)(d.a,{variant:"rounded",className:x.orange,children:e.name.substring(0,1)})}),Object(O.jsx)(st.a,{primary:e.name})]})}))})}),Object(O.jsxs)(Qe.a,{className:x.bottomToolbar,children:[Object(O.jsx)(Ze.a,{}),Object(O.jsxs)(it.a,{button:!0,style:{paddingTop:10},onClick:function(){P(!0)},children:[Object(O.jsx)(at.a,{style:{paddingLeft:6},children:Object(O.jsx)(rt.a,{color:"secondary"})}),Object(O.jsx)(st.a,{primary:"Add channels"})]}),Object(O.jsxs)(it.a,{button:!0,onClick:function(){Y(!0)},children:[Object(O.jsx)(at.a,{style:{paddingLeft:6},children:Object(O.jsx)(lt.a,{color:"secondary"})}),Object(O.jsx)(st.a,{primary:"Invite to Team"})]})]})]}),Object(O.jsxs)("main",{className:x.content,id:"main-container",children:[Object(O.jsx)("div",{className:x.appBarSpacer}),Object(O.jsx)(f.a,{maxWidth:"lg",className:x.container,style:{paddingBottom:0},children:Object(O.jsxs)(c.a,{container:!0,spacing:3,style:{paddingBottom:0},children:[Object(O.jsx)(c.a,{item:!0,xs:12,children:l.map((function(e){return Object(O.jsx)(dt.a,{id:e.id,elevation:1,style:{padding:12,marginBottom:24},children:Object(O.jsxs)(c.a,{container:!0,spacing:3,style:{overflow:!0},children:[Object(O.jsx)(c.a,{item:!0,xs:1,style:{paddingBottom:0},children:e.is_vc?Object(O.jsx)(Re.a,{style:{height:32,width:32,margin:"auto",paddingBottom:0}}):Object(O.jsx)(d.a,{variant:"rounded",className:x.orange,style:{height:32,width:32,margin:"auto",paddingBottom:0},children:e.sender.name.substring(0,1)})}),Object(O.jsx)(c.a,{item:!0,xs:5,style:{paddingLeft:0,paddingBottom:0},children:e.is_vc?Object(O.jsx)(B.b,{to:e.text,style:{textDecoration:"none"},target:"_blank",children:Object(O.jsx)(p.a,{align:"left",color:"primary",children:"Join Call"})}):Object(O.jsx)(p.a,{align:"left",color:"primary",children:e.sender.name})}),Object(O.jsx)(c.a,{item:!0,xs:6,style:{paddingBottom:0},children:Object(O.jsx)(p.a,{align:"right",color:"textSecondary",children:e.timestamp.split(":")[0].slice(-2)+":"+e.timestamp.split(":")[1]})}),Object(O.jsx)(c.a,{item:!0,xs:11,style:{marginLeft:"auto",paddingLeft:0,paddingTop:0},children:e.is_vc?Object(O.jsx)(p.a,{align:"left",children:"Started by "+e.sender.name}):Object(O.jsx)(p.a,{align:"left",children:e.text})})]})})}))}),Object(O.jsx)(c.a,{item:!0,xs:12,style:{position:"sticky",bottom:0,paddingBottom:24,paddingTop:24,backgroundColor:"#fafafa",width:900},children:Object(O.jsx)(u.a,{id:"outlined-textarea",label:"Message",placeholder:"Message",inputRef:n,type:"text",multiline:!0,variant:"outlined",fullWidth:!0,onKeyDown:function(e){"Enter"===e.key&&ne()},InputProps:{endAdornment:Object(O.jsxs)(ht.a,{position:"end",children:[Object(O.jsx)(ue.a,{"aria-label":"send",edge:"end",onClick:function(){ne(!0)},children:Object(O.jsx)(V.a,{fontSize:"large"})}),Object(O.jsx)(ue.a,{"aria-label":"send",edge:"end",onClick:function(){ne()},children:Object(O.jsx)(fe.a,{})})]})}})})]})})]})]})}var pt=function(){var e=Object(w.e)(),t=Object(w.f)(),n=Object(i.useState)(""),a=Object(r.a)(n,2),s=a[0],o=a[1],d=Object(i.useState)(""),h=Object(r.a)(d,2),u=h[0],m=h[1],g=Object(i.useState)(!1),j=Object(r.a)(g,2),b=j[0],v=j[1],f=Object(i.useState)(!1),x=Object(r.a)(f,2),y=x[0],A=x[1],I=Object(i.useState)(""),T=Object(r.a)(I,2),M=T[0],B=T[1],L=Object(i.useState)(!1),U=Object(r.a)(L,2),D=U[0],W=U[1];Object(i.useEffect)((function(){console.log(t.pathname),F.a.get("token")&&"/"===t.pathname&&e.push("/home")}),[e]);var P=function(e){o(e),qe.a.isEmail(e)?v(!1):v(!0)},V=function(e){m(e),qe.a.isStrongPassword(e,{minLength:8,minLowercase:0,minUppercase:0,minNumbers:0,minSymbols:1})?A(!1):A(!0)},J=function(){if(qe.a.isEmail(s)&&qe.a.isStrongPassword(u,{minLength:8,minLowercase:0,minUppercase:0,minNumbers:0,minSymbols:1})){var t={method:"post",url:"/api/login",headers:{"Content-Type":"application/json"},data:JSON.stringify({email:s,password:u})};E()(t).then((function(t){console.log(JSON.stringify(t.data)),F.a.set("token",t.data.token,{expires:365,secure:!0}),e.push("/home")})).catch((function(e){console.log(e)}))}},_=function(){if(qe.a.isEmail(s)&&qe.a.isStrongPassword(u,{minLength:8,minLowercase:0,minUppercase:0,minNumbers:0,minSymbols:1})){var t={method:"post",url:"/api/users",headers:{"Content-Type":"application/json"},data:JSON.stringify({email:s,password:u,name:M})};E()(t).then((function(t){console.log(JSON.stringify(t.data)),F.a.set("token",t.data.token,{expires:365,secure:!0}),e.push("/home")})).catch((function(e){console.log(e)}))}};return Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)(w.a,{path:"/",exact:!0,render:function(e){return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)("div",{className:"login",children:Object(O.jsxs)(c.a,{container:!0,direction:"column",justify:"center",alignItems:"center",style:{minHeight:"100vh",background:"#fafafa"},children:[Object(O.jsx)(c.a,{container:!0,item:!0,xs:3,children:Object(O.jsx)(k.a,{style:{alignItems:"flex-start"},children:Object(O.jsx)(N.a,{children:Object(O.jsx)(c.a,{container:!0,justify:"flex-start",children:Object(O.jsx)(p.a,{variant:"h4",color:"inherit",noWrap:!0,children:"Relier"})})})})}),Object(O.jsx)(c.a,{container:!0,item:!0,xs:3,children:Object(O.jsxs)(R.a,{isFlipped:D,flipDirection:"vertical",children:[Object(O.jsx)(l.a,{elevation:3,children:Object(O.jsx)(S,{email:s,changeEmail:P,password:u,changePassword:V,onLogin:J,setFlip:W,emailWarn:b,passwordWarn:y})}),Object(O.jsx)(l.a,{elevation:3,children:Object(O.jsx)(C,{email:s,changeEmail:P,password:u,changePassword:V,name:M,setName:B,setFlip:W,onRegister:_,emailWarn:b,passwordWarn:y})})]})})]})})})}}),Object(O.jsx)(w.a,{path:"/home/:teamSecret?",children:Object(O.jsx)(K,{})}),Object(O.jsx)(w.a,{path:"/vc/:sid",children:Object(O.jsx)(_e,{})}),Object(O.jsx)(w.a,{path:"/team/:secret",children:Object(O.jsx)(bt,{})})]})},vt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,482)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,s=t.getLCP,o=t.getTTFB;n(e),i(e),a(e),s(e),o(e)}))};o.a.render(Object(O.jsx)(a.a.StrictMode,{children:Object(O.jsx)(B.a,{children:Object(O.jsx)(pt,{})})}),document.getElementById("root")),vt()}},[[406,1,2]]]);
//# sourceMappingURL=main.5f4d3e92.chunk.js.map